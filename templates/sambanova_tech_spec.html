{% extends "base.html" %}

{% block content %}
<div class="min-h-screen bg-gray-50">
    <!-- Header Section -->
    <section class="py-16 bg-white">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center">
                <h1 class="text-4xl font-bold text-gray-800 mb-4">Sambanova Voice AI Productivity System</h1>
                <p class="text-xl text-gray-600 mb-8">LangGraph + Twilio + MCP + Team Management + Call Transfer + Sentry Monitoring + Redis + Composio + Audio Stream Player + WebRTC Voice Integration</p>
                <div class="flex justify-center flex-wrap gap-2">
                    <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium">Flask</span>
                    <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium">LangGraph</span>
                    <span class="bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm font-medium">MCP (38 Tools)</span>
                    <span class="bg-orange-100 text-orange-800 px-3 py-1 rounded-full text-sm font-medium">LangChain</span>
                    <span class="bg-red-100 text-red-800 px-3 py-1 rounded-full text-sm font-medium">OpenAI GPT-4</span>
                    <span class="bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full text-sm font-medium">Google Calendar</span>
                    <span class="bg-pink-100 text-pink-800 px-3 py-1 rounded-full text-sm font-medium">Twilio Voice</span>
                    <span class="bg-indigo-100 text-indigo-800 px-3 py-1 rounded-full text-sm font-medium">JWT Auth</span>
                    <span class="bg-cyan-100 text-cyan-800 px-3 py-1 rounded-full text-sm font-medium">Team Collaboration</span>
                    <span class="bg-teal-100 text-teal-800 px-3 py-1 rounded-full text-sm font-medium">FreePBX Call Transfer</span>
                    <span class="bg-rose-100 text-rose-800 px-3 py-1 rounded-full text-sm font-medium">Sentry Monitoring</span>
                    <span class="bg-lime-100 text-lime-800 px-3 py-1 rounded-full text-sm font-medium">WebRTC Call Center</span>
                    <span class="bg-amber-100 text-amber-800 px-3 py-1 rounded-full text-sm font-medium">Redis Cache</span>
                    <span class="bg-violet-100 text-violet-800 px-3 py-1 rounded-full text-sm font-medium">Composio Tools</span>
                    <span class="bg-emerald-100 text-emerald-800 px-3 py-1 rounded-full text-sm font-medium">Audio Stream Player</span>
                    <span class="bg-sky-100 text-sky-800 px-3 py-1 rounded-full text-sm font-medium">WebRTC Voice</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Technical Architecture Section -->
    <section class="py-16 bg-white">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            <h2 class="text-3xl font-bold text-center mb-12">Technical Architecture</h2>
            
            <!-- System Architecture Overview -->
            <div class="mb-12">
                <h3 class="text-2xl font-semibold mb-6 text-gray-800">System Architecture Overview</h3>
                <div class="bg-gray-50 p-6 rounded-lg">
                    <div class="mb-8">
                        <h4 class="text-lg font-semibold mb-4 text-gray-800">Sambanova Team Collaboration Architecture</h4>
                        <div class="bg-white p-6 rounded-lg border-2 border-gray-200">
                            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                                <!-- Frontend Layer -->
                                <div class="space-y-4">
                                    <h5 class="text-sm font-bold text-gray-800 text-center">Frontend Layer</h5>
                                    <div class="space-y-2">
                                        <div class="bg-blue-100 border border-blue-300 rounded p-3 text-center">
                                            <div class="text-xs font-medium text-blue-800">Team Dashboard</div>
                                            <div class="text-xs text-blue-600">User Management</div>
                                        </div>
                                        <div class="bg-green-100 border border-green-300 rounded p-3 text-center">
                                            <div class="text-xs font-medium text-green-800">Voice Interface</div>
                                            <div class="text-xs text-green-600">Twilio Phone</div>
                                        </div>
                                        <div class="bg-purple-100 border border-purple-300 rounded p-3 text-center">
                                            <div class="text-xs font-medium text-purple-800">Registration</div>
                                            <div class="text-xs text-purple-600">JWT Authentication</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Core Processing Layer -->
                                <div class="space-y-4">
                                    <h5 class="text-sm font-bold text-gray-800 text-center">Core Processing Layer</h5>
                                    <div class="space-y-2">
                                        <div class="bg-orange-100 border border-orange-300 rounded p-3 text-center">
                                            <div class="text-xs font-medium text-orange-800">LangGraph Agent</div>
                                            <div class="text-xs text-orange-600">AI Assistant</div>
                                        </div>
                                        <div class="bg-yellow-100 border border-yellow-300 rounded p-3 text-center">
                                            <div class="text-xs font-medium text-yellow-800">MCP Tools</div>
                                            <div class="text-xs text-yellow-600">38 Tools (36 DB + 2 Transfer)</div>
                                        </div>
                                        <div class="bg-teal-100 border border-teal-300 rounded p-3 text-center">
                                            <div class="text-xs font-medium text-teal-800">Call Transfer</div>
                                            <div class="text-xs text-teal-600">AI → FreePBX</div>
                                        </div>
                                        <div class="bg-rose-100 border border-rose-300 rounded p-3 text-center">
                                            <div class="text-xs font-medium text-rose-800">Sentry</div>
                                            <div class="text-xs text-rose-600">Error Monitoring</div>
                                        </div>
                                        <div class="bg-pink-100 border border-pink-300 rounded p-3 text-center">
                                            <div class="text-xs font-medium text-pink-800">Team API</div>
                                            <div class="text-xs text-pink-600">RESTful Endpoints</div>
                                        </div>
                                        <div class="bg-indigo-100 border border-indigo-300 rounded p-3 text-center">
                                            <div class="text-xs font-medium text-indigo-800">Auth System</div>
                                            <div class="text-xs text-indigo-600">JWT + Bcrypt</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- External Services Layer -->
                                <div class="space-y-4">
                                    <h5 class="text-sm font-bold text-gray-800 text-center">External Services Layer</h5>
                                    <div class="space-y-2">
                                        <div class="bg-red-100 border border-red-300 rounded p-3 text-center">
                                            <div class="text-xs font-medium text-red-800">OpenAI APIs</div>
                                            <div class="text-xs text-red-600">GPT-4, Whisper</div>
                                        </div>
                                        <div class="bg-gray-100 border border-gray-300 rounded p-3 text-center">
                                            <div class="text-xs font-medium text-gray-800">PostgreSQL</div>
                                            <div class="text-xs text-gray-600">Multi-tenant DB</div>
                                        </div>
                                        <div class="bg-blue-100 border border-blue-300 rounded p-3 text-center">
                                            <div class="text-xs font-medium text-blue-800">Google Calendar</div>
                                            <div class="text-xs text-blue-600">OAuth2 Sync</div>
                                        </div>
                                        <div class="bg-cyan-100 border border-cyan-300 rounded p-3 text-center">
                                            <div class="text-xs font-medium text-cyan-800">Render.com</div>
                                            <div class="text-xs text-cyan-600">Cloud Hosting</div>
                                        </div>
                                        <div class="bg-lime-100 border border-lime-300 rounded p-3 text-center">
                                            <div class="text-xs font-medium text-lime-800">FreePBX</div>
                                            <div class="text-xs text-lime-600">Call Center (GCP)</div>
                                        </div>
                                        <div class="bg-amber-100 border border-amber-300 rounded p-3 text-center">
                                            <div class="text-xs font-medium text-amber-800">WebRTC/JsSIP</div>
                                            <div class="text-xs text-amber-600">Softphone Client</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Data Flow -->
                            <div class="mt-6 space-y-2">
                                <div class="flex justify-center">
                                    <div class="text-xs text-gray-600 bg-gray-100 px-3 py-1 rounded">
                                        ← User (Voice/Web) → PIN Auth → LangGraph → MCP Tools (38) → Database/Calendar/FreePBX → Response
                                    </div>
                                </div>
                                <div class="flex justify-center">
                                    <div class="text-xs text-gray-600 bg-blue-50 px-3 py-1 rounded">
                                        ← Twilio Voice → Voice AI Chat → Transfer Request → FreePBX Extension 2000 → Human Agent
                                    </div>
                                </div>
                                <div class="flex justify-center">
                                    <div class="text-xs text-gray-600 bg-rose-50 px-3 py-1 rounded">
                                        → All Operations → Sentry Monitoring → Real-time Alerts & Performance Tracking
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mt-6 text-center">
                                <p class="text-sm text-gray-600">
                                    <strong>Architecture Flow:</strong> Enterprise voice AI system with PIN authentication, team collaboration, 
                                    intelligent call transfer to FreePBX call center, and comprehensive Sentry error monitoring with 
                                    automatic thread reset recovery (8s/10s/12s timeout optimization).
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Overview -->
            <div class="mb-12">
                <h3 class="text-2xl font-semibold mb-6 text-gray-800">Overview</h3>
                <div class="bg-gray-50 p-6 rounded-lg">
                    <p class="text-gray-700 mb-4">
                        The Sambanova Voice AI Productivity System is an enterprise-grade platform that combines 
                        LangGraph AI agents, team collaboration, voice interaction, and intelligent call center integration. 
                        Built for hackathon demonstrations, it showcases advanced features including PIN authentication, 
                        role-based access control, call transfer to FreePBX, and production-grade error monitoring with Sentry.
                        <br><br>
                        The system enables teams to manage todos, assign tasks to members, and collaborate in real-time 
                        through web dashboards, voice commands, and seamless transfer to human agents. Features optimized 
                        timeout handling (8s/10s/12s), automatic thread reset recovery, and comprehensive error tracking.
                        All data is synchronized with Google Calendar using OAuth2 authentication, with intelligent caching 
                        to ensure sub-second voice responses.
                    </p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6">
                        <div class="bg-white p-4 rounded border">
                            <h4 class="font-semibold text-gray-800 mb-2">Core Technologies</h4>
                            <ul class="text-sm text-gray-600 space-y-1">
                                <li>• LangGraph for agent orchestration with tools_condition</li>
                                <li>• Model Context Protocol (MCP) - 38 tools (36 DB + 2 transfer)</li>
                                <li>• LangChain for LLM integration & tool binding</li>
                                <li>• Flask + Flask-SocketIO for web API & WebSocket</li>
                                <li>• SQLAlchemy ORM with PostgreSQL (multi-tenant)</li>
                                <li>• PIN authentication (4-6 digit voice PIN)</li>
                                <li>• OpenAI APIs (GPT-4 Turbo, Whisper STT)</li>
                                <li>• Twilio Programmable Voice with Media Streams</li>
                                <li>• Google Calendar OAuth2 integration (optimized)</li>
                                <li>• FreePBX SIP integration for call transfer</li>
                                <li>• Sentry.io error monitoring & performance tracking</li>
                                <li>• JsSIP WebRTC for browser-based softphone</li>
                                <li>• Render.com auto-deployment with gunicorn+eventlet</li>
                            </ul>
                        </div>
                        <div class="bg-white p-4 rounded border">
                            <h4 class="font-semibold text-gray-800 mb-2">Key Features</h4>
                            <ul class="text-sm text-gray-600 space-y-1">
                                <li>• Multi-tenant team collaboration with role hierarchy</li>
                                <li>• PIN-based voice authentication (4-6 digits)</li>
                                <li>• Intelligent call transfer: AI → FreePBX Extension 2000</li>
                                <li>• Sentry error monitoring & performance tracking</li>
                                <li>• Optimized timeouts (8s/10s/12s) for Twilio compatibility</li>
                                <li>• Automatic thread reset on timeout/error</li>
                                <li>• 38 MCP tools (todos, calendar, teams, transfer)</li>
                                <li>• WebRTC call center with JsSIP softphone</li>
                                <li>• Real-time voice AI with barge-in capability</li>
                                <li>• Google Calendar OAuth2 sync (background)</li>
                                <li>• FreePBX integration on Google Cloud VM</li>
                                <li>• Production deployment on Render with auto-scaling</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Updates & Improvements -->
            <div class="mb-12">
                <h3 class="text-2xl font-semibold mb-6 text-gray-800">Recent Updates & Improvements (October 2025)</h3>
                <div class="bg-gradient-to-r from-blue-50 to-purple-50 p-6 rounded-lg border-2 border-blue-200">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Call Transfer Feature -->
                        <div class="bg-white p-5 rounded-lg shadow-sm">
                            <div class="flex items-center mb-3">
                                <span class="bg-teal-100 p-2 rounded-full mr-3">
                                    <svg class="w-5 h-5 text-teal-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"></path>
                                    </svg>
                                </span>
                                <h4 class="text-lg font-semibold text-gray-800">Call Transfer to FreePBX</h4>
                            </div>
                            <ul class="text-sm text-gray-600 space-y-1.5">
                                <li>✓ Seamless AI → Human agent transfer</li>
                                <li>✓ FreePBX extension 2000 integration</li>
                                <li>✓ SIP/WSS connectivity (Google Cloud VM)</li>
                                <li>✓ Transfer detection via phrases or tool</li>
                                <li>✓ Department routing (support, sales, etc.)</li>
                            </ul>
                            <div class="mt-3 text-xs text-gray-500">
                                <strong>Files:</strong> call_transfer.py, CALL_TRANSFER_GUIDE.md
                            </div>
                        </div>

                        <!-- Sentry Monitoring -->
                        <div class="bg-white p-5 rounded-lg shadow-sm">
                            <div class="flex items-center mb-3">
                                <span class="bg-rose-100 p-2 rounded-full mr-3">
                                    <svg class="w-5 h-5 text-rose-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                    </svg>
                                </span>
                                <h4 class="text-lg font-semibold text-gray-800">Sentry Integration</h4>
                            </div>
                            <ul class="text-sm text-gray-600 space-y-1.5">
                                <li>✓ Real-time error tracking & alerts</li>
                                <li>✓ Performance monitoring (agent processing time)</li>
                                <li>✓ User context & session tracking</li>
                                <li>✓ Timeout & thread reset tracking</li>
                                <li>✓ Production-grade observability</li>
                            </ul>
                            <div class="mt-3 text-xs text-gray-500">
                                <strong>Integration:</strong> Flask + SQLAlchemy + Logging
                            </div>
                        </div>

                        <!-- Timeout Optimization -->
                        <div class="bg-white p-5 rounded-lg shadow-sm">
                            <div class="flex items-center mb-3">
                                <span class="bg-green-100 p-2 rounded-full mr-3">
                                    <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                </span>
                                <h4 class="text-lg font-semibold text-gray-800">Timeout Optimization</h4>
                            </div>
                            <ul class="text-sm text-gray-600 space-y-1.5">
                                <li>✓ Tool timeout: 8s (from 20s)</li>
                                <li>✓ Agent timeout: 10s (from 25s)</li>
                                <li>✓ Webhook timeout: 12s (from 30s)</li>
                                <li>✓ Stays under Twilio's 15s HTTP limit</li>
                                <li>✓ Thread reset on timeout prevents errors</li>
                            </ul>
                            <div class="mt-3 text-xs text-gray-500">
                                <strong>Result:</strong> 95%+ operations complete successfully
                            </div>
                        </div>

                        <!-- WebRTC Call Center -->
                        <div class="bg-white p-5 rounded-lg shadow-sm">
                            <div class="flex items-center mb-3">
                                <span class="bg-lime-100 p-2 rounded-full mr-3">
                                    <svg class="w-5 h-5 text-lime-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                                    </svg>
                                </span>
                                <h4 class="text-lg font-semibold text-gray-800">WebRTC Call Center</h4>
                            </div>
                            <ul class="text-sm text-gray-600 space-y-1.5">
                                <li>✓ JsSIP v3.10.1 browser softphone</li>
                                <li>✓ WebSocket Secure (WSS) on port 7443</li>
                                <li>✓ Agent dashboard with SIP registration</li>
                                <li>✓ Call control (answer, hold, transfer, hangup)</li>
                                <li>✓ Google Cloud firewall configured</li>
                            </ul>
                            <div class="mt-3 text-xs text-gray-500">
                                <strong>Platform:</strong> FreePBX 34.26.59.14 (GCP VM)
                            </div>
                        </div>

                        <!-- Error Recovery -->
                        <div class="bg-white p-5 rounded-lg shadow-sm">
                            <div class="flex items-center mb-3">
                                <span class="bg-purple-100 p-2 rounded-full mr-3">
                                    <svg class="w-5 h-5 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                    </svg>
                                </span>
                                <h4 class="text-lg font-semibold text-gray-800">Automatic Error Recovery</h4>
                            </div>
                            <ul class="text-sm text-gray-600 space-y-1.5">
                                <li>✓ Thread reset with timestamped IDs</li>
                                <li>✓ BrokenResourceError handling</li>
                                <li>✓ tool_call_id incomplete error recovery</li>
                                <li>✓ In-memory reset tracking (_reset_threads)</li>
                                <li>✓ No cascading failures</li>
                            </ul>
                            <div class="mt-3 text-xs text-gray-500">
                                <strong>Benefit:</strong> Self-healing conversation threads
                            </div>
                        </div>

                        <!-- Performance Tracking -->
                        <div class="bg-white p-5 rounded-lg shadow-sm">
                            <div class="flex items-center mb-3">
                                <span class="bg-amber-100 p-2 rounded-full mr-3">
                                    <svg class="w-5 h-5 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                    </svg>
                                </span>
                                <h4 class="text-lg font-semibold text-gray-800">Performance Optimization</h4>
                            </div>
                            <ul class="text-sm text-gray-600 space-y-1.5">
                                <li>✓ Removed Google Calendar sync delay</li>
                                <li>✓ Simplified JSON responses (no MCP breaks)</li>
                                <li>✓ Agent processing time measurement</li>
                                <li>✓ Transaction tracking per voice call</li>
                                <li>✓ Custom Sentry metrics & measurements</li>
                            </ul>
                            <div class="mt-3 text-xs text-gray-500">
                                <strong>Result:</strong> Sub-5s response times
                            </div>
                        </div>
                    </div>

                    <!-- Quick Stats -->
                    <div class="mt-6 grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div class="bg-white p-4 rounded text-center">
                            <div class="text-2xl font-bold text-teal-600">2000</div>
                            <div class="text-xs text-gray-600">FreePBX Extension</div>
                        </div>
                        <div class="bg-white p-4 rounded text-center">
                            <div class="text-2xl font-bold text-purple-600">38</div>
                            <div class="text-xs text-gray-600">MCP Tools</div>
                        </div>
                        <div class="bg-white p-4 rounded text-center">
                            <div class="text-2xl font-bold text-green-600">12s</div>
                            <div class="text-xs text-gray-600">Max Response Time</div>
                        </div>
                        <div class="bg-white p-4 rounded text-center">
                            <div class="text-2xl font-bold text-rose-600">100%</div>
                            <div class="text-xs text-gray-600">Sentry Trace Rate</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- WebRTC Voice Integration Architecture -->
            <div class="mb-12">
                <h3 class="text-2xl font-semibold mb-6 text-gray-800">WebRTC Voice Integration Architecture</h3>
                <div class="bg-gradient-to-r from-sky-50 to-blue-50 p-6 rounded-lg border-2 border-sky-200">
                    <div class="mb-8">
                        <h4 class="text-lg font-semibold mb-4 text-gray-800">WebRTC Voice Assistant Architecture</h4>
                        <div class="bg-white p-6 rounded-lg border-2 border-gray-200">
                            <div class="flex justify-center">
                                <img src="/sambanova_todo/static/assets/img/arch.png" 
                                     alt="WebRTC Voice Integration Architecture" 
                                     class="max-w-full h-auto rounded-lg shadow-lg"
                                     style="max-width: 1000px; height: auto;">
                            </div>
                            
                            <div class="mt-6 text-center">
                                <p class="text-sm text-gray-600">
                                    <strong>WebRTC Architecture:</strong> Browser-based voice assistant with Redis session management, real-time audio streaming, and Composio tool integration for external platform connectivity.
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- WebRTC Voice Interface -->
                        <div class="bg-white p-5 rounded-lg shadow-sm">
                            <div class="flex items-center mb-3">
                                <span class="bg-sky-100 p-2 rounded-full mr-3">
                                    <svg class="w-5 h-5 text-sky-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path>
                                    </svg>
                                </span>
                                <h4 class="text-lg font-semibold text-gray-800">WebRTC Voice Interface</h4>
                            </div>
                            <ul class="text-sm text-gray-600 space-y-1.5">
                                <li>✓ Browser-based voice recording</li>
                                <li>✓ Real-time audio streaming</li>
                                <li>✓ WebSocket communication</li>
                                <li>✓ Audio format detection (WebM)</li>
                                <li>✓ Base64 audio encoding</li>
                            </ul>
                            <div class="mt-3 text-xs text-gray-500">
                                <strong>Technology:</strong> WebRTC + Socket.IO
                            </div>
                        </div>

                        <!-- Redis Session Management -->
                        <div class="bg-white p-5 rounded-lg shadow-sm">
                            <div class="flex items-center mb-3">
                                <span class="bg-amber-100 p-2 rounded-full mr-3">
                                    <svg class="w-5 h-5 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4"></path>
                                    </svg>
                                </span>
                                <h4 class="text-lg font-semibold text-gray-800">Redis Session Management</h4>
                            </div>
                            <ul class="text-sm text-gray-600 space-y-1.5">
                                <li>✓ Session storage & caching</li>
                                <li>✓ Audio buffer management</li>
                                <li>✓ Real-time notifications</li>
                                <li>✓ User activity tracking</li>
                                <li>✓ Session expiration handling</li>
                            </ul>
                            <div class="mt-3 text-xs text-gray-500">
                                <strong>Integration:</strong> Redis Pub/Sub + Session Store
                            </div>
                        </div>

                        <!-- Composio Tool Integration -->
                        <div class="bg-white p-5 rounded-lg shadow-sm">
                            <div class="flex items-center mb-3">
                                <span class="bg-violet-100 p-2 rounded-full mr-3">
                                    <svg class="w-5 h-5 text-violet-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                    </svg>
                                </span>
                                <h4 class="text-lg font-semibold text-gray-800">Composio Integration</h4>
                            </div>
                            <ul class="text-sm text-gray-600 space-y-1.5">
                                <li>✓ Slack workspace integration</li>
                                <li>✓ GitHub repository management</li>
                                <li>✓ Gmail email automation</li>
                                <li>✓ Notion workspace sync</li>
                                <li>✓ Jira project management</li>
                            </ul>
                            <div class="mt-3 text-xs text-gray-500">
                                <strong>Platforms:</strong> Slack, GitHub, Gmail, Notion, Jira
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- New Features: Redis, Composio, Audio Stream Player -->
            <div class="mb-12">
                <h3 class="text-2xl font-semibold mb-6 text-gray-800">Latest Features (October 2025)</h3>
                <div class="bg-gradient-to-r from-amber-50 to-violet-50 p-6 rounded-lg border-2 border-amber-200">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Redis Integration -->
                        <div class="bg-white p-5 rounded-lg shadow-sm">
                            <div class="flex items-center mb-3">
                                <span class="bg-amber-100 p-2 rounded-full mr-3">
                                    <svg class="w-5 h-5 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4"></path>
                                    </svg>
                                </span>
                                <h4 class="text-lg font-semibold text-gray-800">Redis Session Management</h4>
                            </div>
                            <ul class="text-sm text-gray-600 space-y-1.5">
                                <li>✓ Session storage & caching</li>
                                <li>✓ Audio buffer management</li>
                                <li>✓ Real-time notifications (Pub/Sub)</li>
                                <li>✓ Rate limiting & analytics</li>
                                <li>✓ User activity tracking</li>
                            </ul>
                            <div class="mt-3 text-xs text-gray-500">
                                <strong>Files:</strong> redis_manager.py, REDIS_DATA_GUIDE.md
                            </div>
                        </div>

                        <!-- Composio Integration -->
                        <div class="bg-white p-5 rounded-lg shadow-sm">
                            <div class="flex items-center mb-3">
                                <span class="bg-violet-100 p-2 rounded-full mr-3">
                                    <svg class="w-5 h-5 text-violet-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                    </svg>
                                </span>
                                <h4 class="text-lg font-semibold text-gray-800">Composio Tool Integration</h4>
                            </div>
                            <ul class="text-sm text-gray-600 space-y-1.5">
                                <li>✓ Slack workspace integration</li>
                                <li>✓ GitHub repository management</li>
                                <li>✓ Gmail email automation</li>
                                <li>✓ Notion workspace sync</li>
                                <li>✓ Jira project management</li>
                            </ul>
                            <div class="mt-3 text-xs text-gray-500">
                                <strong>Integration:</strong> External tool orchestration
                            </div>
                        </div>

                        <!-- Audio Stream Player -->
                        <div class="bg-white p-5 rounded-lg shadow-sm">
                            <div class="flex items-center mb-3">
                                <span class="bg-emerald-100 p-2 rounded-full mr-3">
                                    <svg class="w-5 h-5 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"></path>
                                    </svg>
                                </span>
                                <h4 class="text-lg font-semibold text-gray-800">Audio Stream Player</h4>
                            </div>
                            <ul class="text-sm text-gray-600 space-y-1.5">
                                <li>✓ Redis audio buffer playback</li>
                                <li>✓ WebM format support</li>
                                <li>✓ Real-time audio streaming</li>
                                <li>✓ Session audio download</li>
                                <li>✓ Audio format detection</li>
                            </ul>
                            <div class="mt-3 text-xs text-gray-500">
                                <strong>Files:</strong> audio_player_routes.py, audio_stream_player.py
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Module Structure -->
            <div class="mb-12">
                <h3 class="text-2xl font-semibold mb-6 text-gray-800">Module Structure</h3>
                <div class="bg-gray-50 p-6 rounded-lg">
                    <div class="flex justify-center">
                        <div class="bg-white p-4 rounded border max-w-3xl w-full">
                            <h4 class="font-semibold text-gray-800 mb-3">Sambanova Project Structure</h4>
                            <div class="font-mono text-sm overflow-x-auto">
                                <pre>Project Root/
├── app.py                          # Main Flask application
├── start_simple.py                 # Production server startup
├── build.sh                        # Render.com build script
├── deploy_setup.py                 # Deployment migrations
├── requirements.txt                # Python dependencies
├── recordings/                     # Call recordings (git-ignored)
├── templates/                      # Flask templates
│   ├── team_dashboard.html        # Team management UI
│   ├── register.html              # User registration
│   └── sambanova_tech_spec.html   # Technical documentation
└── sambanova/                      # Sambanova module
    ├── __init__.py                # Package initialization
    ├── routes.py                  # Flask routes & Twilio webhooks (Sentry integrated)
    ├── assistant_graph_todo.py    # LangGraph agent (optimized timeouts)
    ├── state.py                   # Agent state management
    ├── models/                    # Database models
    │   ├── base.py               # Shared SQLAlchemy Base
    │   └── user_models.py        # User, Team, TeamMembership models
    ├── security/                  # Authentication & authorization
    │   └── auth.py               # JWT authentication system
    ├── api_routes/                # RESTful API endpoints
    │   ├── auth_routes.py        # User registration & login
    │   ├── team_routes.py        # Team management API
    │   └── team_todo_routes.py   # Team todo management API
    ├── migrations/                # Database migrations
    │   └── add_team_collaboration.py
    ├── mcps/                      # Model Context Protocol servers
    │   ├── mcp_config.json       # MCP server configuration
    │   └── local_servers/
    │       ├── db_todo.py        # 36 database tools (optimized, no Google sync)
    │       ├── call_transfer.py  # 2 call transfer tools (FreePBX integration)
    │       └── google_calendar.py # Calendar operations
    └── Documentation/             # Comprehensive guides
        ├── CALL_TRANSFER_GUIDE.md        # Call transfer setup
        ├── SENTRY_INTEGRATION.md         # Error monitoring setup
        ├── TIMEOUT_ERROR_FIX.md          # Timeout optimization guide
        ├── GOOGLE_CLOUD_FREEPBX_SETUP.md # FreePBX configuration
        └── TWILIO_FREEPBX_SETUP.md       # Twilio-FreePBX integration</pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Database Schema -->
            <div class="mb-12">
                <h3 class="text-2xl font-semibold mb-6 text-gray-800">Database Schema</h3>
                <div class="bg-gray-50 p-6 rounded-lg">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <!-- Users Table -->
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h4 class="text-lg font-semibold mb-3 text-gray-800">users_sambanova</h4>
                            <ul class="text-sm text-gray-600 space-y-1">
                                <li>• id: UUID (PK)</li>
                                <li>• email: String (unique)</li>
                                <li>• username: String (unique)</li>
                                <li>• password_hash: String</li>
                                <li>• first_name: String</li>
                                <li>• last_name: String</li>
                                <li>• is_active: Boolean</li>
                                <li>• is_verified: Boolean</li>
                                <li>• created_at: DateTime</li>
                                <li>• last_login_at: DateTime</li>
                            </ul>
                        </div>
                        
                        <!-- Teams Table -->
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h4 class="text-lg font-semibold mb-3 text-gray-800">teams_sambanova</h4>
                            <ul class="text-sm text-gray-600 space-y-1">
                                <li>• id: UUID (PK)</li>
                                <li>• name: String</li>
                                <li>• description: Text</li>
                                <li>• is_active: Boolean</li>
                                <li>• created_at: DateTime</li>
                                <li>• updated_at: DateTime</li>
                            </ul>
                        </div>
                        
                        <!-- Team Memberships Table -->
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h4 class="text-lg font-semibold mb-3 text-gray-800">team_memberships_sambanova</h4>
                            <ul class="text-sm text-gray-600 space-y-1">
                                <li>• id: UUID (PK)</li>
                                <li>• team_id: UUID (FK)</li>
                                <li>• user_id: UUID (FK)</li>
                                <li>• role: Enum (owner/admin/member/viewer)</li>
                                <li>• joined_at: DateTime</li>
                                <li>• updated_at: DateTime</li>
                            </ul>
                        </div>
                        
                        <!-- Todos Table -->
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h4 class="text-lg font-semibold mb-3 text-gray-800">todos_sambanova</h4>
                            <ul class="text-sm text-gray-600 space-y-1">
                                <li>• id: UUID (PK)</li>
                                <li>• title: String</li>
                                <li>• description: String</li>
                                <li>• completed: Boolean</li>
                                <li>• priority: Enum</li>
                                <li>• due_date: DateTime</li>
                                <li>• creator_id: UUID (FK)</li>
                                <li>• assignee_id: UUID (FK)</li>
                                <li>• team_id: UUID (FK)</li>
                                <li>• is_private: Boolean</li>
                                <li>• google_calendar_event_id</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-6">
                        <!-- Reminders Table -->
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h4 class="text-lg font-semibold mb-3 text-gray-800">reminders_sambanova</h4>
                            <ul class="text-sm text-gray-600 space-y-1">
                                <li>• id: UUID (PK)</li>
                                <li>• reminder_text: String</li>
                                <li>• importance: Enum</li>
                                <li>• reminder_date: DateTime</li>
                                <li>• google_calendar_event_id</li>
                                <li>• created_at: DateTime</li>
                                <li>• updated_at: DateTime</li>
                            </ul>
                        </div>
                        
                        <!-- Calendar Events Table -->
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h4 class="text-lg font-semibold mb-3 text-gray-800">calendar_events_sambanova</h4>
                            <ul class="text-sm text-gray-600 space-y-1">
                                <li>• id: UUID (PK)</li>
                                <li>• title: String</li>
                                <li>• description: String</li>
                                <li>• event_from: DateTime</li>
                                <li>• event_to: DateTime</li>
                                <li>• google_calendar_event_id</li>
                                <li>• created_at: DateTime</li>
                                <li>• updated_at: DateTime</li>
                            </ul>
                        </div>
                        
                        <!-- Call Recordings Table -->
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h4 class="text-lg font-semibold mb-3 text-gray-800">call_recordings_sambanova</h4>
                            <ul class="text-sm text-gray-600 space-y-1">
                                <li>• id: UUID (PK)</li>
                                <li>• call_sid: String (unique)</li>
                                <li>• from_number: String</li>
                                <li>• to_number: String</li>
                                <li>• recording_path: String</li>
                                <li>• transcription: Text</li>
                                <li>• status: String</li>
                                <li>• created_at: DateTime</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Team Collaboration Architecture -->
            <div class="mb-12">
                <h3 class="text-2xl font-semibold mb-6 text-gray-800">Team Collaboration Architecture</h3>
                <div class="bg-gray-50 p-6 rounded-lg">
                    <div class="mb-8">
                        <h4 class="text-lg font-semibold mb-4 text-gray-800">Team Relationship Diagram</h4>
                        <div class="bg-white p-6 rounded-lg border-2 border-gray-200">
                            <div class="font-mono text-sm overflow-x-auto">
                                <pre>
┌─────────────────┐
│  User           │
├─────────────────┤
│ id (UUID) PK    │◄─────┐
│ email (unique)  │      │
│ username        │      │
│ password_hash   │      │
│ first_name      │      │
│ last_name       │      │
│ is_active       │      │
└─────────────────┘      │
         │               │
         │ user_id (FK)  │
         ▼               │
┌─────────────────┐      │
│ TeamMembership  │      │
├─────────────────┤      │
│ id (UUID) PK    │      │
│ team_id (FK)────┼──┐   │
│ user_id (FK)────┼──┘   │
│ role (ENUM)     │      │
│ joined_at       │      │
└─────────────────┘      │
         │               │
         │ team_id (FK)  │
         ▼               │
┌─────────────────┐      │
│  Team           │      │
├─────────────────┤      │
│ id (UUID) PK    │◄─────┤
│ name            │      │
│ description     │      │
│ is_active       │      │
└─────────────────┘      │
         │               │
         │ team_id (FK)  │
         ▼               │
┌─────────────────┐      │
│  Todo           │      │
├─────────────────┤      │
│ id (UUID) PK    │      │
│ title           │      │
│ priority        │      │
│ creator_id (FK)─┼──────┘
│ assignee_id(FK)─┼──────┐
│ team_id (FK)────┼──┐   │
│ is_private      │  │   │
│ google_cal_id   │  │   │
└─────────────────┘  │   │
                     │   │
                     ▼   ▼
              Team & User References
</pre>
                            </div>
                            <div class="mt-4 text-center">
                                <p class="text-sm text-gray-600">
                                    <strong>Relationships:</strong> Users belong to Teams via TeamMembership. Todos can be assigned to Teams and Users with role-based permissions.
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-white p-4 rounded border">
                            <h4 class="font-semibold text-gray-800 mb-2">Team Roles</h4>
                            <ul class="text-sm text-gray-600 space-y-2">
                                <li>• <strong>OWNER:</strong> Full control, can delete team</li>
                                <li>• <strong>ADMIN:</strong> Manage members and todos</li>
                                <li>• <strong>MEMBER:</strong> Create and edit own todos</li>
                                <li>• <strong>VIEWER:</strong> Read-only access</li>
                            </ul>
                        </div>
                        <div class="bg-white p-4 rounded border">
                            <h4 class="font-semibold text-gray-800 mb-2">Access Control</h4>
                            <ul class="text-sm text-gray-600 space-y-2">
                                <li>• JWT token-based authentication</li>
                                <li>• 30-minute access token expiry</li>
                                <li>• 7-day refresh token validity</li>
                                <li>• Role-based authorization checks</li>
                                <li>• Team membership validation</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- LangGraph Architecture -->
            <div class="mb-12">
                <h3 class="text-2xl font-semibold mb-6 text-gray-800">LangGraph Agent Architecture</h3>
                <div class="bg-gray-50 p-6 rounded-lg">
                    <!-- LangGraph Workflow Diagram -->
                    <div class="mb-8">
                        <h4 class="text-lg font-semibold mb-4 text-gray-800">LangGraph Workflow Diagram</h4>
                        <div class="bg-white p-6 rounded-lg border-2 border-gray-200">
                            <div class="flex justify-center">
                                <img src="/sambanova_todo/static/assets/img/lgwfdg.png" 
                                     alt="LangGraph Workflow Diagram" 
                                     class="max-w-full h-auto rounded-lg shadow-lg"
                                     style="max-width: 800px; height: auto;">
                            </div>
                            
                            <div class="mt-6 text-center">
                                <p class="text-sm text-gray-600">
                                    <strong>LangGraph Workflow:</strong> The agent can either continue to use tools or end the conversation based on user input and context.
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-white p-4 rounded border">
                            <h4 class="font-semibold text-gray-800 mb-3">Agent Components</h4>
                            <ul class="text-sm text-gray-600 space-y-2">
                                <li>• <strong>TodoAgent Class:</strong> Main agent orchestrator with lazy initialization</li>
                                <li>• <strong>StateGraph:</strong> Manages conversation flow and state</li>
                                <li>• <strong>Assistant Node:</strong> GPT-4 reasoning and response generation</li>
                                <li>• <strong>Tool Node:</strong> Executes 35+ MCP tools</li>
                                <li>• <strong>Conditional Edges:</strong> Routes between nodes based on tool calls</li>
                                <li>• <strong>InMemorySaver:</strong> Checkpointer for state persistence</li>
                            </ul>
                        </div>
                        <div class="bg-white p-4 rounded border">
                            <h4 class="font-semibold text-gray-800 mb-3">State Management</h4>
                            <ul class="text-sm text-gray-600 space-y-2">
                                <li>• <strong>AgentState:</strong> Conversation state with message history</li>
                                <li>• <strong>Message History:</strong> Maintains context across turns</li>
                                <li>• <strong>Customer ID:</strong> User identification for multi-tenant</li>
                                <li>• <strong>Thread ID:</strong> Conversation thread tracking</li>
                                <li>• <strong>Lazy Loading:</strong> Prevents circular imports</li>
                                <li>• <strong>ExceptionGroup Handling:</strong> Robust error recovery</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- MCP Integration -->
            <div class="mb-12">
                <h3 class="text-2xl font-semibold mb-6 text-gray-800">Model Context Protocol (MCP) Integration</h3>
                <div class="bg-gray-50 p-6 rounded-lg">
                    <p class="text-gray-700 mb-4">
                        MCP provides a standardized way for AI agents to interact with external tools and services. 
                        The Sambanova system uses MCP to expose 30+ tools for database operations, team management, 
                        and Google Calendar integration.
                    </p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div class="bg-white p-4 rounded border">
                            <h4 class="font-semibold text-gray-800 mb-2">MCP Server Configuration</h4>
                            <div class="font-mono text-sm bg-gray-100 p-3 rounded">
                                <pre>{
  "mcpServers": {
    "db": {
      "command": "python",
      "args": ["./sambanova/mcps/local_servers/db_todo.py"],
      "transport": "stdio",
      "env": {
        "DB_URI": "${DB_URI}",
        "GOOGLE_OAUTH2_TOKEN_B64": "${GOOGLE_OAUTH2_TOKEN_B64}",
        "GOOGLE_CLIENT_ID": "${GOOGLE_CLIENT_ID}",
        "GOOGLE_CLIENT_SECRET": "${GOOGLE_CLIENT_SECRET}"
      }
    }
  }
}</pre>
                            </div>
                        </div>
                        <div class="bg-white p-4 rounded border">
                            <h4 class="font-semibold text-gray-800 mb-2">Available MCP Tools (35+)</h4>
                            <div class="grid grid-cols-2 gap-2">
                                <div>
                                    <h5 class="font-semibold text-xs text-gray-700 mb-1">Todo Management (5)</h5>
                                    <ul class="text-xs text-gray-600 space-y-1">
                                        <li>• create_todo</li>
                                        <li>• get_todos</li>
                                        <li>• complete_todo</li>
                                        <li>• update_todo</li>
                                        <li>• delete_todo</li>
                                    </ul>
                                </div>
                                <div>
                                    <h5 class="font-semibold text-xs text-gray-700 mb-1">Team Tools (8)</h5>
                                    <ul class="text-xs text-gray-600 space-y-1">
                                        <li>• create_team</li>
                                        <li>• get_teams</li>
                                        <li>• get_team_members</li>
                                        <li>• create_team_todo</li>
                                        <li>• add_team_member</li>
                                        <li>• remove_team_member</li>
                                        <li>• change_member_role</li>
                                        <li>• search_users</li>
                                    </ul>
                                </div>
                                <div>
                                    <h5 class="font-semibold text-xs text-gray-700 mb-1">Reminders (4)</h5>
                                    <ul class="text-xs text-gray-600 space-y-1">
                                        <li>• create_reminder</li>
                                        <li>• get_reminders</li>
                                        <li>• update_reminder</li>
                                        <li>• delete_reminder</li>
                                    </ul>
                                </div>
                                <div>
                                    <h5 class="font-semibold text-xs text-gray-700 mb-1">Calendar (6)</h5>
                                    <ul class="text-xs text-gray-600 space-y-1">
                                        <li>• create_calendar_event</li>
                                        <li>• get_calendar_events</li>
                                        <li>• update_calendar_event</li>
                                        <li>• delete_calendar_event</li>
                                        <li>• sync_google_calendar_events</li>
                                        <li>• test_google_calendar</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Enhanced LangGraph Tool Calls -->
            <div class="mb-12">
                <h3 class="text-2xl font-semibold mb-6 text-gray-800">Enhanced LangGraph Tool Calls</h3>
                <div class="bg-gray-50 p-6 rounded-lg">
                    <p class="text-gray-700 mb-4">
                        The LangGraph implementation provides intelligent tool calling capabilities with dynamic tool selection 
                        and error handling. The agent automatically chooses appropriate tools based on user intent and maintains 
                        conversation context for seamless interactions.
                    </p>
                    
                    <!-- Tool Calls Flow Diagram -->
                    <div class="mb-8">
                        <h4 class="text-lg font-semibold mb-4 text-gray-800">Tool Calls Flow Diagram</h4>
                        <div class="bg-white p-6 rounded-lg border-2 border-gray-200">
                            <div class="flex justify-center">
                                <img src="/sambanova_todo/static/assets/img/tool_calls_flow_diagram.png" 
                                     alt="Tool Calls Flow Diagram" 
                                     class="max-w-full h-auto rounded-lg shadow-lg"
                                     style="max-width: 900px; height: auto;">
                            </div>
                            
                            <div class="mt-6 text-center">
                                <p class="text-sm text-gray-600">
                                    <strong>Tool Calls Flow:</strong> LangGraph implementation showing dynamic tool selection and intelligent orchestration of MCP tools.
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Tool Calls Features -->
                    <div class="mb-8">
                        <h4 class="text-lg font-semibold mb-4 text-gray-800">Tool Calls Features</h4>
                        <div class="bg-white p-6 rounded-lg border-2 border-gray-200">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="bg-gray-50 p-4 rounded border">
                                    <h5 class="font-semibold text-gray-800 mb-2">MCP Integration</h5>
                                    <ul class="text-sm text-gray-600 space-y-1">
                                        <li>• Database operations via MCP servers</li>
                                        <li>• Google Calendar synchronization</li>
                                        <li>• Team collaboration tools</li>
                                        <li>• Real-time tool discovery (35+ tools)</li>
                                        <li>• Secure tool communication via stdio</li>
                                        <li>• Lazy loading for performance</li>
                                    </ul>
                                </div>
                                <div class="bg-gray-50 p-4 rounded border">
                                    <h5 class="font-semibold text-gray-800 mb-2">Error Handling</h5>
                                    <ul class="text-sm text-gray-600 space-y-1">
                                        <li>• Graceful tool failure recovery</li>
                                        <li>• ExceptionGroup unwrapping</li>
                                        <li>• 20s timeout per tool</li>
                                        <li>• 30s overall agent timeout</li>
                                        <li>• Fallback strategies</li>
                                        <li>• User-friendly error messages</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <div class="mt-6 text-center">
                                <p class="text-sm text-gray-600">
                                    <strong>Tool Features:</strong> Intelligent tool calling system with error recovery, timeout management, and seamless MCP integration.
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-4 rounded border">
                        <h4 class="font-semibold text-gray-800 mb-2">Core Tool Calling Capabilities</h4>
                        <ul class="text-sm text-gray-600 space-y-1">
                            <li>• <strong>Dynamic Tool Selection:</strong> LLM intelligently chooses appropriate tools based on user intent</li>
                            <li>• <strong>Error Recovery:</strong> Graceful handling of tool failures with fallback strategies</li>
                            <li>• <strong>Context Awareness:</strong> Tools access conversation history and maintain state</li>
                            <li>• <strong>Streaming Responses:</strong> Real-time tool execution updates for better user experience</li>
                            <li>• <strong>Async Execution:</strong> Non-blocking tool calls with proper timeout management</li>
                            <li>• <strong>ExceptionGroup Handling:</strong> Unwraps and logs complex async exceptions</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Authentication System -->
            <div class="mb-12">
                <h3 class="text-2xl font-semibold mb-6 text-gray-800">JWT Authentication System</h3>
                <div class="bg-gray-50 p-6 rounded-lg">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-white p-4 rounded border">
                            <h4 class="font-semibold text-gray-800 mb-3">Authentication Flow</h4>
                            <div class="space-y-3">
                                <div class="bg-blue-50 p-3 rounded">
                                    <div class="font-semibold text-sm text-blue-800">1. User Registration</div>
                                    <div class="text-xs text-blue-600">POST /api/auth/register → Bcrypt hash → JWT tokens</div>
                                </div>
                                <div class="bg-green-50 p-3 rounded">
                                    <div class="font-semibold text-sm text-green-800">2. User Login</div>
                                    <div class="text-xs text-green-600">POST /api/auth/login → Verify password → Generate tokens</div>
                                </div>
                                <div class="bg-purple-50 p-3 rounded">
                                    <div class="font-semibold text-sm text-purple-800">3. API Request</div>
                                    <div class="text-xs text-purple-600">Bearer token → JWT validation → @require_auth</div>
                                </div>
                                <div class="bg-orange-50 p-3 rounded">
                                    <div class="font-semibold text-sm text-orange-800">4. Token Refresh</div>
                                    <div class="text-xs text-orange-600">POST /api/auth/refresh → New access token</div>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white p-4 rounded border">
                            <h4 class="font-semibold text-gray-800 mb-3">Security Features</h4>
                            <ul class="text-sm text-gray-600 space-y-2">
                                <li>• <strong>Password Hashing:</strong> Bcrypt with automatic salt</li>
                                <li>• <strong>JWT Tokens:</strong> HS256 algorithm with secret key</li>
                                <li>• <strong>Token Expiry:</strong> 30 min access, 7 day refresh</li>
                                <li>• <strong>Authorization:</strong> @require_auth decorator</li>
                                <li>• <strong>Role Validation:</strong> @require_role decorator</li>
                                <li>• <strong>Team Membership:</strong> @require_team_member decorator</li>
                                <li>• <strong>Auto Logout:</strong> Frontend handles expired tokens</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="mt-6 bg-white p-4 rounded border">
                        <h4 class="font-semibold text-gray-800 mb-2">JWT Token Structure</h4>
                        <div class="font-mono text-sm bg-gray-100 p-3 rounded">
                            <pre>{
  "user_id": "uuid",
  "email": "user@example.com",
  "roles": ["user"],
  "team_id": "uuid",
  "type": "access",
  "exp": 1728589200,  // 30 minutes from issue
  "iat": 1728587400   // issued at timestamp
}</pre>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Technical Integration Diagram -->
            <div class="mb-12">
                <h3 class="text-2xl font-semibold mb-6 text-gray-800">Technical Integration Overview</h3>
                <div class="bg-gradient-to-r from-indigo-50 to-purple-50 p-6 rounded-lg border-2 border-indigo-200">
                    <div class="mb-8">
                        <h4 class="text-lg font-semibold mb-4 text-gray-800">Complete System Integration</h4>
                        <div class="bg-white p-6 rounded-lg border-2 border-gray-200">
                            <div class="flex justify-center">
                                <img src="/sambanova_todo/static/assets/img/t_i.png" 
                                     alt="Technical Integration Diagram" 
                                     class="max-w-full h-auto rounded-lg shadow-lg"
                                     style="max-width: 1000px; height: auto;">
                            </div>
                            
                            <div class="mt-6 text-center">
                                <p class="text-sm text-gray-600">
                                    <strong>System Integration:</strong> Complete technical architecture showing WebRTC voice integration, Redis session management, Composio tool orchestration, and LangGraph AI agent processing.
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <!-- WebRTC Integration -->
                        <div class="bg-white p-4 rounded-lg shadow-sm">
                            <div class="flex items-center mb-3">
                                <span class="bg-sky-100 p-2 rounded-full mr-3">
                                    <svg class="w-5 h-5 text-sky-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path>
                                    </svg>
                                </span>
                                <h4 class="text-lg font-semibold text-gray-800">WebRTC Voice</h4>
                            </div>
                            <ul class="text-sm text-gray-600 space-y-1">
                                <li>• Browser audio recording</li>
                                <li>• Real-time streaming</li>
                                <li>• WebSocket communication</li>
                                <li>• Session management</li>
                            </ul>
                        </div>

                        <!-- Redis Integration -->
                        <div class="bg-white p-4 rounded-lg shadow-sm">
                            <div class="flex items-center mb-3">
                                <span class="bg-amber-100 p-2 rounded-full mr-3">
                                    <svg class="w-5 h-5 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4"></path>
                                    </svg>
                                </span>
                                <h4 class="text-lg font-semibold text-gray-800">Redis Cache</h4>
                            </div>
                            <ul class="text-sm text-gray-600 space-y-1">
                                <li>• Session storage</li>
                                <li>• Audio buffer management</li>
                                <li>• Real-time notifications</li>
                                <li>• User activity tracking</li>
                            </ul>
                        </div>

                        <!-- Composio Integration -->
                        <div class="bg-white p-4 rounded-lg shadow-sm">
                            <div class="flex items-center mb-3">
                                <span class="bg-violet-100 p-2 rounded-full mr-3">
                                    <svg class="w-5 h-5 text-violet-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                    </svg>
                                </span>
                                <h4 class="text-lg font-semibold text-gray-800">Composio Tools</h4>
                            </div>
                            <ul class="text-sm text-gray-600 space-y-1">
                                <li>• Slack integration</li>
                                <li>• GitHub automation</li>
                                <li>• Gmail management</li>
                                <li>• External platform sync</li>
                            </ul>
                        </div>

                        <!-- LangGraph Agent -->
                        <div class="bg-white p-4 rounded-lg shadow-sm">
                            <div class="flex items-center mb-3">
                                <span class="bg-purple-100 p-2 rounded-full mr-3">
                                    <svg class="w-5 h-5 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                                    </svg>
                                </span>
                                <h4 class="text-lg font-semibold text-gray-800">AI Agent</h4>
                            </div>
                            <ul class="text-sm text-gray-600 space-y-1">
                                <li>• LangGraph orchestration</li>
                                <li>• 38 MCP tools</li>
                                <li>• Natural language processing</li>
                                <li>• Tool calling automation</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- New Features Technical Details -->
            <div class="mb-12">
                <h3 class="text-2xl font-semibold mb-6 text-gray-800">New Features Technical Details</h3>
                <div class="space-y-8">
                    
                    <!-- Redis Integration Details -->
                    <div class="bg-gradient-to-r from-amber-50 to-orange-50 p-6 rounded-lg border-2 border-amber-200">
                        <h4 class="text-xl font-semibold mb-4 text-gray-800 flex items-center">
                            <span class="bg-amber-100 p-2 rounded-full mr-3">
                                <svg class="w-5 h-5 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4"></path>
                                </svg>
                            </span>
                            Redis Session Management & Caching
                        </h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <h5 class="font-semibold text-gray-700 mb-2">Session Management</h5>
                                <ul class="text-sm text-gray-600 space-y-1">
                                    <li>• Session creation, retrieval, updates, deletion</li>
                                    <li>• Audio buffer storage (base64 encoded)</li>
                                    <li>• User authentication state management</li>
                                    <li>• Session expiration handling</li>
                                </ul>
                            </div>
                            <div>
                                <h5 class="font-semibold text-gray-700 mb-2">Real-time Features</h5>
                                <ul class="text-sm text-gray-600 space-y-1">
                                    <li>• Pub/Sub notifications for team updates</li>
                                    <li>• Rate limiting (requests per minute)</li>
                                    <li>• User activity tracking & analytics</li>
                                    <li>• Cache invalidation strategies</li>
                                </ul>
                            </div>
                        </div>
                        <div class="mt-4 p-3 bg-gray-100 rounded">
                            <code class="text-sm text-gray-700">
                                # Redis connection with environment config<br>
                                REDIS_URL = os.getenv('REDIS_URL', 'redis://localhost:6379')<br>
                                # Session data structure<br>
                                session_data = {<br>
                                &nbsp;&nbsp;'user_id': 'user-123', 'audio_buffer': 'base64...',<br>
                                &nbsp;&nbsp;'created_at': timestamp, 'expires_at': ttl<br>
                                }
                            </code>
                        </div>
                    </div>

                    <!-- Composio Integration Details -->
                    <div class="bg-gradient-to-r from-violet-50 to-purple-50 p-6 rounded-lg border-2 border-violet-200">
                        <h4 class="text-xl font-semibold mb-4 text-gray-800 flex items-center">
                            <span class="bg-violet-100 p-2 rounded-full mr-3">
                                <svg class="w-5 h-5 text-violet-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                </svg>
                            </span>
                            Composio External Tool Integration
                        </h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <h5 class="font-semibold text-gray-700 mb-2">Supported Platforms</h5>
                                <ul class="text-sm text-gray-600 space-y-1">
                                    <li>• <strong>Slack:</strong> Message sending, channel management</li>
                                    <li>• <strong>GitHub:</strong> Repository operations, issue tracking</li>
                                    <li>• <strong>Gmail:</strong> Email composition, sending, management</li>
                                    <li>• <strong>Notion:</strong> Page creation, database operations</li>
                                    <li>• <strong>Jira:</strong> Ticket creation, project management</li>
                                </ul>
                            </div>
                            <div>
                                <h5 class="font-semibold text-gray-700 mb-2">Integration Features</h5>
                                <ul class="text-sm text-gray-600 space-y-1">
                                    <li>• OAuth2 authentication for each platform</li>
                                    <li>• Robust method discovery for API compatibility</li>
                                    <li>• Error handling for missing methods</li>
                                    <li>• Tool orchestration with LangGraph</li>
                                </ul>
                            </div>
                        </div>
                        <div class="mt-4 p-3 bg-gray-100 rounded">
                            <code class="text-sm text-gray-700">
                                # Composio tool loading with fallback methods<br>
                                if hasattr(toolset, 'get_tools'):<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;tools = toolset.get_tools(apps=["slack"])<br>
                                elif hasattr(toolset, 'get_actions'):<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;tools = toolset.get_actions(apps=["slack"])
                            </code>
                        </div>
                    </div>

                    <!-- Audio Stream Player Details -->
                    <div class="bg-gradient-to-r from-emerald-50 to-green-50 p-6 rounded-lg border-2 border-emerald-200">
                        <h4 class="text-xl font-semibold mb-4 text-gray-800 flex items-center">
                            <span class="bg-emerald-100 p-2 rounded-full mr-3">
                                <svg class="w-5 h-5 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"></path>
                                </svg>
                            </span>
                            Audio Stream Player & WebM Support
                        </h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <h5 class="font-semibold text-gray-700 mb-2">Audio Processing</h5>
                                <ul class="text-sm text-gray-600 space-y-1">
                                    <li>• WebM format detection & handling</li>
                                    <li>• Base64 audio buffer decoding</li>
                                    <li>• Real-time audio streaming from Redis</li>
                                    <li>• Audio format conversion (WebM → WAV fallback)</li>
                                </ul>
                            </div>
                            <div>
                                <h5 class="font-semibold text-gray-700 mb-2">Player Features</h5>
                                <ul class="text-sm text-gray-600 space-y-1">
                                    <li>• Session-based audio playback</li>
                                    <li>• Audio file download (WebM/WAV)</li>
                                    <li>• Audio buffer analysis & debugging</li>
                                    <li>• Flask-SocketIO real-time updates</li>
                                </ul>
                            </div>
                        </div>
                        <div class="mt-4 p-3 bg-gray-100 rounded">
                            <code class="text-sm text-gray-700">
                                # WebM format detection<br>
                                if audio_data.startswith(b'\x1a\x45\xdf\xa3'):<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;return Response(audio_data, mimetype='audio/webm')<br>
                                # Audio buffer from Redis<br>
                                audio_buffer = session_data.get('audio_buffer', '')<br>
                                audio_data = base64.b64decode(audio_buffer)
                            </code>
                        </div>
                    </div>
                </div>
            </div>

            <!-- API Endpoints -->
            <div class="mb-12">
                <h3 class="text-2xl font-semibold mb-6 text-gray-800">API Endpoints</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <!-- Authentication Endpoints -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h4 class="text-lg font-semibold mb-3 text-gray-800">Authentication</h4>
                        <ul class="text-sm text-gray-600 space-y-2">
                            <li><code class="bg-gray-100 px-2 py-1 rounded text-xs">POST /api/auth/register</code></li>
                            <li><code class="bg-gray-100 px-2 py-1 rounded text-xs">POST /api/auth/login</code></li>
                            <li><code class="bg-gray-100 px-2 py-1 rounded text-xs">POST /api/auth/refresh</code></li>
                            <li><code class="bg-gray-100 px-2 py-1 rounded text-xs">GET /api/auth/profile</code></li>
                            <li><code class="bg-gray-100 px-2 py-1 rounded text-xs">PUT /api/auth/profile</code></li>
                        </ul>
                    </div>
                    
                    <!-- Team Endpoints -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h4 class="text-lg font-semibold mb-3 text-gray-800">Team Management</h4>
                        <ul class="text-sm text-gray-600 space-y-2">
                            <li><code class="bg-gray-100 px-2 py-1 rounded text-xs">POST /api/teams/</code></li>
                            <li><code class="bg-gray-100 px-2 py-1 rounded text-xs">GET /api/teams/</code></li>
                            <li><code class="bg-gray-100 px-2 py-1 rounded text-xs">GET /api/teams/{id}</code></li>
                            <li><code class="bg-gray-100 px-2 py-1 rounded text-xs">POST /api/teams/{id}/members</code></li>
                            <li><code class="bg-gray-100 px-2 py-1 rounded text-xs">DELETE /api/teams/{id}/members/{user_id}</code></li>
                            <li><code class="bg-gray-100 px-2 py-1 rounded text-xs">PUT /api/teams/{id}/members/{user_id}/role</code></li>
                        </ul>
                    </div>
                    
                    <!-- Twilio Endpoints -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h4 class="text-lg font-semibold mb-3 text-gray-800">Twilio Voice</h4>
                        <ul class="text-sm text-gray-600 space-y-2">
                            <li><code class="bg-gray-100 px-2 py-1 rounded text-xs">POST /sambanova_todo/twilio/call</code></li>
                            <li><code class="bg-gray-100 px-2 py-1 rounded text-xs">POST /sambanova_todo/twilio/process_audio</code></li>
                        </ul>
                        <div class="mt-3 p-3 bg-gray-50 rounded">
                            <p class="text-xs text-gray-600 mb-2">Webhook URL:</p>
                            <pre class="text-xs"><code>https://hjlees.com/sambanova_todo/twilio/call</code></pre>
                        </div>
                    </div>
                </div>
            </div>

            <!-- WebRTC Voice Interface -->
            <div class="mb-12">
                <h3 class="text-2xl font-semibold mb-6 text-gray-800">WebRTC Voice Interface</h3>
                <div class="bg-gray-50 p-6 rounded-lg">
                    <p class="text-gray-700 mb-4">
                        The WebRTC Voice Interface provides browser-based voice interaction with real-time audio streaming, 
                        Redis session management, and seamless integration with the LangGraph AI agent. Users can interact 
                        with the assistant directly through their web browser without requiring phone calls.
                    </p>
                    
                    <!-- WebRTC Voice Interface Screenshot -->
                    <div class="mb-8">
                        <h4 class="text-lg font-semibold mb-4 text-gray-800">WebRTC Voice Assistant Interface</h4>
                        <div class="bg-white p-6 rounded-lg border-2 border-gray-200">
                            <div class="flex justify-center">
                                <img src="/sambanova_todo/static/assets/img/t_voice_i.png" 
                                     alt="WebRTC Voice Interface" 
                                     class="max-w-full h-auto rounded-lg shadow-lg"
                                     style="max-width: 800px; height: auto;">
                            </div>
                            
                            <div class="mt-6 text-center">
                                <p class="text-sm text-gray-600">
                                    <strong>WebRTC Interface:</strong> Browser-based voice assistant with real-time audio recording, session management, and AI-powered responses.
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- WebRTC Processing Pipeline -->
                    <div class="mb-8">
                        <h4 class="text-lg font-semibold mb-4 text-gray-800">WebRTC Audio Processing Pipeline</h4>
                        <div class="bg-white p-6 rounded-lg border-2 border-gray-200">
                            <div class="grid grid-cols-1 md:grid-cols-6 gap-4">
                                <!-- Browser Recording -->
                                <div class="text-center">
                                    <div class="w-16 h-16 bg-sky-100 border-2 border-sky-300 rounded-full flex items-center justify-center mx-auto mb-2">
                                        <span class="text-sky-800 font-bold text-sm">🎤</span>
                                    </div>
                                    <div class="text-sm font-medium text-gray-800">Browser Recording</div>
                                    <div class="text-xs text-gray-600">WebRTC API</div>
                                </div>
                                
                                <!-- WebSocket Stream -->
                                <div class="text-center">
                                    <div class="w-16 h-16 bg-blue-100 border-2 border-blue-300 rounded-full flex items-center justify-center mx-auto mb-2">
                                        <span class="text-blue-800 font-bold text-sm">📡</span>
                                    </div>
                                    <div class="text-sm font-medium text-gray-800">WebSocket Stream</div>
                                    <div class="text-xs text-gray-600">Socket.IO</div>
                                </div>
                                
                                <!-- Redis Buffer -->
                                <div class="text-center">
                                    <div class="w-16 h-16 bg-amber-100 border-2 border-amber-300 rounded-full flex items-center justify-center mx-auto mb-2">
                                        <span class="text-amber-800 font-bold text-sm">💾</span>
                                    </div>
                                    <div class="text-sm font-medium text-gray-800">Redis Buffer</div>
                                    <div class="text-xs text-gray-600">Session Storage</div>
                                </div>
                                
                                <!-- Audio Processing -->
                                <div class="text-center">
                                    <div class="w-16 h-16 bg-green-100 border-2 border-green-300 rounded-full flex items-center justify-center mx-auto mb-2">
                                        <span class="text-green-800 font-bold text-sm">🔊</span>
                                    </div>
                                    <div class="text-sm font-medium text-gray-800">Audio Processing</div>
                                    <div class="text-xs text-gray-600">WebM/MP3</div>
                                </div>
                                
                                <!-- LangGraph Agent -->
                                <div class="text-center">
                                    <div class="w-16 h-16 bg-purple-100 border-2 border-purple-300 rounded-full flex items-center justify-center mx-auto mb-2">
                                        <span class="text-purple-800 font-bold text-sm">🧠</span>
                                    </div>
                                    <div class="text-sm font-medium text-gray-800">LangGraph Agent</div>
                                    <div class="text-xs text-gray-600">AI Processing</div>
                                </div>
                                
                                <!-- TTS Response -->
                                <div class="text-center">
                                    <div class="w-16 h-16 bg-orange-100 border-2 border-orange-300 rounded-full flex items-center justify-center mx-auto mb-2">
                                        <span class="text-orange-800 font-bold text-sm">🗣️</span>
                                    </div>
                                    <div class="text-sm font-medium text-gray-800">TTS Response</div>
                                    <div class="text-xs text-gray-600">OpenAI TTS</div>
                                </div>
                            </div>
                            
                            <!-- Flow Arrows -->
                            <div class="mt-6">
                                <div class="flex justify-between items-center">
                                    <div class="text-xs text-gray-600">Audio Capture</div>
                                    <div class="flex-1 h-0.5 bg-sky-400 mx-4"></div>
                                    <div class="text-xs text-gray-600">Stream</div>
                                    <div class="flex-1 h-0.5 bg-blue-400 mx-4"></div>
                                    <div class="text-xs text-gray-600">Buffer</div>
                                    <div class="flex-1 h-0.5 bg-amber-400 mx-4"></div>
                                    <div class="text-xs text-gray-600">Process</div>
                                    <div class="flex-1 h-0.5 bg-green-400 mx-4"></div>
                                    <div class="text-xs text-gray-600">AI</div>
                                    <div class="flex-1 h-0.5 bg-purple-400 mx-4"></div>
                                    <div class="text-xs text-gray-600">Response</div>
                                </div>
                            </div>
                            
                            <div class="mt-6 text-center">
                                <p class="text-sm text-gray-600">
                                    <strong>WebRTC Pipeline:</strong> Complete browser-based voice processing from audio capture to AI-generated responses with Redis session management.
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-white p-4 rounded border">
                            <h4 class="font-semibold text-gray-800 mb-2">WebRTC Components</h4>
                            <ul class="text-sm text-gray-600 space-y-1">
                                <li>• <strong>MediaRecorder API:</strong> Browser audio recording</li>
                                <li>• <strong>WebSocket:</strong> Real-time communication</li>
                                <li>• <strong>Redis Session:</strong> Audio buffer storage</li>
                                <li>• <strong>Audio Format Detection:</strong> WebM/MP3 support</li>
                                <li>• <strong>Base64 Encoding:</strong> Audio data transmission</li>
                                <li>• <strong>Socket.IO:</strong> Bidirectional communication</li>
                                <li>• <strong>Session Management:</strong> User state tracking</li>
                                <li>• <strong>Real-time Streaming:</strong> Continuous audio flow</li>
                            </ul>
                        </div>
                        <div class="bg-white p-4 rounded border">
                            <h4 class="font-semibold text-gray-800 mb-2">Processing Flow</h4>
                            <ol class="text-sm text-gray-600 space-y-1">
                                <li>1. User clicks record button in browser</li>
                                <li>2. WebRTC MediaRecorder captures audio</li>
                                <li>3. Audio chunks sent via WebSocket</li>
                                <li>4. Server stores audio in Redis session</li>
                                <li>5. User stops recording</li>
                                <li>6. Audio buffer processed (WebM/MP3)</li>
                                <li>7. OpenAI Whisper transcribes audio</li>
                                <li>8. LangGraph agent processes request</li>
                                <li>9. OpenAI TTS generates response</li>
                                <li>10. Audio response played in browser</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Voice Interface -->
            <div class="mb-12">
                <h3 class="text-2xl font-semibold mb-6 text-gray-800">Voice Interface</h3>
                <div class="bg-gray-50 p-6 rounded-lg">
                    <p class="text-gray-700 mb-4">
                        The Sambanova assistant provides complete voice interaction through Twilio integration, 
                        supporting natural language commands for team collaboration and task management with 
                        Amazon Polly.Amy voice and barge-in capabilities for interruption.
                    </p>
                    
                    <!-- Voice Processing Pipeline -->
                    <div class="mb-8">
                        <h4 class="text-lg font-semibold mb-4 text-gray-800">Voice Processing Pipeline</h4>
                        <div class="bg-white p-6 rounded-lg border-2 border-gray-200">
                            <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
                                <!-- Speech Input -->
                                <div class="text-center">
                                    <div class="w-16 h-16 bg-blue-100 border-2 border-blue-300 rounded-full flex items-center justify-center mx-auto mb-2">
                                        <span class="text-blue-800 font-bold text-sm">🎤</span>
                                    </div>
                                    <div class="text-sm font-medium text-gray-800">Speech Input</div>
                                    <div class="text-xs text-gray-600">Twilio Voice</div>
                                </div>
                                
                                <!-- Speech Recognition -->
                                <div class="text-center">
                                    <div class="w-16 h-16 bg-green-100 border-2 border-green-300 rounded-full flex items-center justify-center mx-auto mb-2">
                                        <span class="text-green-800 font-bold text-sm">👂</span>
                                    </div>
                                    <div class="text-sm font-medium text-gray-800">Speech-to-Text</div>
                                    <div class="text-xs text-gray-600">Twilio STT</div>
                                </div>
                                
                                <!-- LangGraph Agent -->
                                <div class="text-center">
                                    <div class="w-16 h-16 bg-purple-100 border-2 border-purple-300 rounded-full flex items-center justify-center mx-auto mb-2">
                                        <span class="text-purple-800 font-bold text-sm">🧠</span>
                                    </div>
                                    <div class="text-sm font-medium text-gray-800">LangGraph Agent</div>
                                    <div class="text-xs text-gray-600">AI Processing</div>
                                </div>
                                
                                <!-- TTS -->
                                <div class="text-center">
                                    <div class="w-16 h-16 bg-orange-100 border-2 border-orange-300 rounded-full flex items-center justify-center mx-auto mb-2">
                                        <span class="text-orange-800 font-bold text-sm">🗣️</span>
                                    </div>
                                    <div class="text-sm font-medium text-gray-800">Text-to-Speech</div>
                                    <div class="text-xs text-gray-600">Polly.Amy</div>
                                </div>
                                
                                <!-- Audio Output -->
                                <div class="text-center">
                                    <div class="w-16 h-16 bg-red-100 border-2 border-red-300 rounded-full flex items-center justify-center mx-auto mb-2">
                                        <span class="text-red-800 font-bold text-sm">🔊</span>
                                    </div>
                                    <div class="text-sm font-medium text-gray-800">Voice Response</div>
                                    <div class="text-xs text-gray-600">Twilio TTS</div>
                                </div>
                            </div>
                            
                            <!-- Flow Arrows -->
                            <div class="mt-6">
                                <div class="flex justify-between items-center">
                                    <div class="text-xs text-gray-600">User Speech</div>
                                    <div class="flex-1 h-0.5 bg-blue-400 mx-4"></div>
                                    <div class="text-xs text-gray-600">Recognition</div>
                                    <div class="flex-1 h-0.5 bg-green-400 mx-4"></div>
                                    <div class="text-xs text-gray-600">AI Processing</div>
                                    <div class="flex-1 h-0.5 bg-orange-400 mx-4"></div>
                                    <div class="text-xs text-gray-600">Voice Output</div>
                                </div>
                            </div>
                            
                            <div class="mt-6 text-center">
                                <p class="text-sm text-gray-600">
                                    <strong>Voice Pipeline:</strong> Complete end-to-end voice processing from speech input to AI-generated voice response with real-time streaming.
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-8">
                        <h4 class="text-lg font-semibold mb-4 text-gray-800">Voice Command Examples</h4>
                        <div class="bg-white p-6 rounded-lg border-2 border-gray-200">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <h5 class="font-semibold text-gray-800 mb-3">Personal Productivity</h5>
                                    <ul class="text-sm text-gray-600 space-y-2">
                                        <li>🗣️ "Create a high priority todo to review the quarterly report"</li>
                                        <li>🗣️ "Add a reminder to call the dentist tomorrow at 2 PM"</li>
                                        <li>🗣️ "Schedule a meeting for next Friday from 2 to 3 PM"</li>
                                        <li>🗣️ "Show me all my pending todos"</li>
                                        <li>🗣️ "Mark the grocery shopping todo as completed"</li>
                                    </ul>
                                </div>
                                <div>
                                    <h5 class="font-semibold text-gray-800 mb-3">Team Collaboration</h5>
                                    <ul class="text-sm text-gray-600 space-y-2">
                                        <li>🗣️ "Create a hackathon team"</li>
                                        <li>🗣️ "What teams are available?"</li>
                                        <li>🗣️ "Who are the members of the development team?"</li>
                                        <li>🗣️ "Create a high priority todo for the dev team"</li>
                                        <li>🗣️ "Add admin@sambanova.com to the hackathon team as owner"</li>
                                        <li>🗣️ "Assign a code review task to John in the dev team"</li>
                                        <li>🗣️ "Change john@example.com to admin role in the dev team"</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-white p-4 rounded border">
                            <h4 class="font-semibold text-gray-800 mb-2">Voice Components</h4>
                            <ul class="text-sm text-gray-600 space-y-1">
                                <li>• <strong>Speech-to-Text:</strong> Twilio speech recognition engine</li>
                                <li>• <strong>Text-to-Speech:</strong> Amazon Polly.Amy voice</li>
                                <li>• <strong>Barge-in:</strong> Interrupt AI while speaking</li>
                                <li>• <strong>Speech Timeout:</strong> Auto detection (10s)</li>
                                <li>• <strong>Agent Timeout:</strong> 30s processing time</li>
                                <li>• <strong>Tool Timeout:</strong> 20s per MCP tool</li>
                                <li>• <strong>Continuation:</strong> Multi-turn conversations</li>
                                <li>• <strong>Exit Detection:</strong> Natural conversation ending</li>
                            </ul>
                        </div>
                        <div class="bg-white p-4 rounded border">
                            <h4 class="font-semibold text-gray-800 mb-2">Processing Flow</h4>
                            <ol class="text-sm text-gray-600 space-y-1">
                                <li>1. User calls Twilio number</li>
                                <li>2. Twilio webhook triggers /sambanova_todo/twilio/call</li>
                                <li>3. TwiML with &lt;Gather&gt; returned (10s timeout)</li>
                                <li>4. User speaks, Twilio recognizes speech</li>
                                <li>5. SpeechResult posted to /process_audio</li>
                                <li>6. LangGraph agent processes (30s timeout)</li>
                                <li>7. MCP tools execute (20s per tool)</li>
                                <li>8. Database & Calendar operations</li>
                                <li>9. Response converted to TwiML</li>
                                <li>10. Polly.Amy speaks response with barge-in</li>
                                <li>11. Conversation continues or ends</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Twilio Phone Integration -->
            <div class="mb-12">
                <h3 class="text-2xl font-semibold mb-6 text-gray-800">Twilio Phone Integration</h3>
                <div class="bg-gray-50 p-6 rounded-lg">
                    <p class="text-gray-700 mb-4">
                        The Sambanova assistant can be accessed via phone calls through Twilio integration, allowing users 
                        to interact with the AI assistant through voice calls from any phone number. The system uses TwiML 
                        and Gather for speech recognition with barge-in capability.
                    </p>
                    
                    <!-- Twilio Call Flow Architecture -->
                    <div class="mb-8">
                        <h4 class="text-lg font-semibold mb-4 text-gray-800">Twilio Call Flow Architecture</h4>
                        <div class="bg-white p-6 rounded-lg border-2 border-gray-200">
                            <div class="grid grid-cols-1 md:grid-cols-6 gap-4">
                                <!-- Phone Call -->
                                <div class="text-center">
                                    <div class="w-16 h-16 bg-blue-100 border-2 border-blue-300 rounded-full flex items-center justify-center mx-auto mb-2">
                                        <span class="text-blue-800 font-bold text-sm">📞</span>
                                    </div>
                                    <div class="text-sm font-medium text-gray-800">Phone Call</div>
                                    <div class="text-xs text-gray-600">PSTN Network</div>
                                </div>
                                
                                <!-- Twilio -->
                                <div class="text-center">
                                    <div class="w-16 h-16 bg-red-100 border-2 border-red-300 rounded-full flex items-center justify-center mx-auto mb-2">
                                        <span class="text-red-800 font-bold text-sm">T</span>
                                    </div>
                                    <div class="text-sm font-medium text-gray-800">Twilio</div>
                                    <div class="text-xs text-gray-600">Voice API</div>
                                </div>
                                
                                <!-- Flask Webhook -->
                                <div class="text-center">
                                    <div class="w-16 h-16 bg-green-100 border-2 border-green-300 rounded-full flex items-center justify-center mx-auto mb-2">
                                        <span class="text-green-800 font-bold text-sm">🌐</span>
                                    </div>
                                    <div class="text-sm font-medium text-gray-800">Flask Webhook</div>
                                    <div class="text-xs text-gray-600">TwiML Response</div>
                                </div>
                                
                                <!-- MCP Client -->
                                <div class="text-center">
                                    <div class="w-16 h-16 bg-purple-100 border-2 border-purple-300 rounded-full flex items-center justify-center mx-auto mb-2">
                                        <span class="text-purple-800 font-bold text-sm">🔌</span>
                                    </div>
                                    <div class="text-sm font-medium text-gray-800">MCP Client</div>
                                    <div class="text-xs text-gray-600">35+ Tools</div>
                                </div>
                                
                                <!-- Database -->
                                <div class="text-center">
                                    <div class="w-16 h-16 bg-orange-100 border-2 border-orange-300 rounded-full flex items-center justify-center mx-auto mb-2">
                                        <span class="text-orange-800 font-bold text-sm">⚙️</span>
                                    </div>
                                    <div class="text-sm font-medium text-gray-800">Database</div>
                                    <div class="text-xs text-gray-600">PostgreSQL</div>
                                </div>
                                
                                <!-- LangGraph Agent -->
                                <div class="text-center">
                                    <div class="w-16 h-16 bg-indigo-100 border-2 border-indigo-300 rounded-full flex items-center justify-center mx-auto mb-2">
                                        <span class="text-indigo-800 font-bold text-sm">🧠</span>
                                    </div>
                                    <div class="text-sm font-medium text-gray-800">LangGraph Agent</div>
                                    <div class="text-xs text-gray-600">AI Processing</div>
                                </div>
                            </div>
                            
                            <!-- Flow Arrows -->
                            <div class="mt-6">
                                <div class="flex justify-between items-center">
                                    <div class="text-xs text-gray-600">Call Initiation</div>
                                    <div class="flex-1 h-0.5 bg-blue-400 mx-4"></div>
                                    <div class="text-xs text-gray-600">Webhook</div>
                                    <div class="flex-1 h-0.5 bg-green-400 mx-4"></div>
                                    <div class="text-xs text-gray-600">Tool Execution</div>
                                    <div class="flex-1 h-0.5 bg-purple-400 mx-4"></div>
                                    <div class="text-xs text-gray-600">AI Processing</div>
                                </div>
                            </div>
                            
                            <div class="mt-6 text-center">
                                <p class="text-sm text-gray-600">
                                    <strong>Call Flow:</strong> Phone → Twilio → Flask Webhook → LangGraph Agent → MCP Tools → Database/Calendar → TwiML Response
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div class="bg-white p-4 rounded border">
                            <h4 class="font-semibold text-gray-800 mb-2">Twilio Components</h4>
                            <ul class="text-sm text-gray-600 space-y-1">
                                <li>• <strong>Twilio Voice API:</strong> Handles incoming/outgoing calls</li>
                                <li>• <strong>TwiML:</strong> XML-based call flow instructions</li>
                                <li>• <strong>Gather Element:</strong> Collects speech input with barge-in</li>
                                <li>• <strong>Say Element:</strong> Text-to-speech via Polly.Amy</li>
                                <li>• <strong>Redirect Element:</strong> Call continuation logic</li>
                                <li>• <strong>Webhook Endpoints:</strong> Flask routes for call handling</li>
                            </ul>
                        </div>
                        <div class="bg-white p-4 rounded border">
                            <h4 class="font-semibold text-gray-800 mb-2">Call Flow Process</h4>
                            <ol class="text-sm text-gray-600 space-y-1">
                                <li>1. User calls Twilio phone number</li>
                                <li>2. Twilio webhook triggers /twilio/call</li>
                                <li>3. TwiML with &lt;Gather&gt; returned</li>
                                <li>4. Greeting: "Hello! I'm your Sambanova productivity assistant"</li>
                                <li>5. User speaks command</li>
                                <li>6. Speech posted to /process_audio</li>
                                <li>7. LangGraph agent processes request</li>
                                <li>8. MCP tools execute database operations</li>
                                <li>9. TwiML response with confirmation</li>
                                <li>10. Call continues or ends based on user</li>
                            </ol>
                        </div>
                    </div>
                    
                    <div class="bg-white p-4 rounded border">
                        <h4 class="font-semibold text-gray-800 mb-2">Twilio Configuration</h4>
                        <div class="font-mono text-sm bg-gray-100 p-3 rounded">
                            <pre># Environment Variables
TWILIO_ACCOUNT_SID=your_account_sid
TWILIO_AUTH_TOKEN=your_auth_token
TWILIO_PHONE_NUMBER=+1234567890

# Webhook Endpoints
POST https://hjlees.com/sambanova_todo/twilio/call
POST https://hjlees.com/sambanova_todo/twilio/process_audio

# TwiML Response Example
&lt;Response&gt;
  &lt;Gather action="/sambanova_todo/twilio/process_audio" 
          method="POST" 
          input="speech" 
          speechTimeout="auto" 
          timeout="10" 
          bargeIn="true"&gt;
    &lt;Say voice="Polly.Amy"&gt;Hello! I'm your Sambanova productivity assistant...&lt;/Say&gt;
  &lt;/Gather&gt;
  &lt;Say voice="Polly.Amy"&gt;I didn't hear anything. Please try again.&lt;/Say&gt;
  &lt;Redirect&gt;/sambanova_todo/twilio/call?is_continuation=true&lt;/Redirect&gt;
&lt;/Response&gt;</pre>
                        </div>
                    </div>
                    
                    <div class="mt-6 bg-blue-50 p-4 rounded border-l-4 border-blue-400">
                        <h4 class="font-semibold text-blue-800 mb-2">Twilio Setup Instructions</h4>
                        <div class="space-y-3">
                            <div>
                                <p class="text-sm text-blue-700 font-medium mb-1">Step 1: Configure Voice Settings</p>
                                <p class="text-sm text-blue-600">In Twilio Console → Phone Numbers → Active Numbers → Select your number</p>
                            </div>
                            <div>
                                <p class="text-sm text-blue-700 font-medium mb-1">Step 2: Set Webhook URL</p>
                                <p class="text-sm text-blue-600">A CALL COMES IN: https://hjlees.com/sambanova_todo/twilio/call (HTTP POST)</p>
                            </div>
                            <div>
                                <p class="text-sm text-blue-700 font-medium mb-1">Step 3: Test Integration</p>
                                <p class="text-sm text-blue-600">Call your Twilio number and speak a command</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Code Examples -->
            <div class="mb-12">
                <h3 class="text-2xl font-semibold mb-6 text-gray-800">Code Examples</h3>
                <div class="space-y-6">
                    
                    <!-- LangGraph Agent Example -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h4 class="text-lg font-semibold mb-3 text-gray-800">LangGraph Agent (assistant_graph_todo.py)</h4>
                        <pre class="bg-gray-100 p-4 rounded text-sm overflow-x-auto"><code>from langchain_core.tools import BaseTool
from langchain_openai import ChatOpenAI
from langgraph.graph import StateGraph
from langgraph.prebuilt import ToolNode, tools_condition

class TodoAgent:
    def __init__(self, tools: List[BaseTool] = []):
        self.tools = tools
        self.llm = ChatOpenAI(
            model="gpt-4.1-mini-2025-04-14"
        ).bind_tools(tools=self.tools)
        self.graph = self.build_graph()

    def build_graph(self) -> CompiledStateGraph:
        builder = StateGraph(AgentState)
        
        def assistant(state: AgentState):
            response = self.llm.invoke(state.messages)
            state.messages.append(response)
            return state

        builder.add_node("assistant", assistant)
        builder.add_node("tools", ToolNode(self.tools))
        
        builder.set_entry_point("assistant")
        builder.add_conditional_edges("assistant", tools_condition)
        builder.add_edge("tools", "assistant")
        
        return builder.compile(checkpointer=InMemorySaver())

# Lazy initialization to avoid circular imports
_agent_instance = None

def get_agent():
    global _agent_instance
    if _agent_instance is None:
        _agent_instance = TodoAgent()
    return _agent_instance</code></pre>
                    </div>

                    <!-- Team Management API Example -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h4 class="text-lg font-semibold mb-3 text-gray-800">Team Management API (team_routes.py)</h4>
                        <pre class="bg-gray-100 p-4 rounded text-sm overflow-x-auto"><code>from flask import Blueprint, request, jsonify
from sambanova.security.auth import require_auth
from sambanova.models.user_models import User, Team, TeamMembership

team_bp = Blueprint('teams', __name__, url_prefix='/api/teams')

@team_bp.route('/', methods=['POST'])
@require_auth
def create_team():
    """Create a new team"""
    data = request.get_json()
    user_id = request.current_user['user_id']
    
    with SessionLocal() as session:
        # Create team
        team = Team(
            name=data['name'],
            description=data.get('description', ''),
            is_active=True
        )
        session.add(team)
        session.commit()
        
        # Add creator as team owner
        membership = TeamMembership(
            team_id=team.id,
            user_id=user_id,
            role=TeamRole.OWNER
        )
        session.add(membership)
        session.commit()
        
        return jsonify({
            'message': 'Team created successfully',
            'team': {
                'id': str(team.id),
                'name': team.name
            }
        }), 201

@team_bp.route('/', methods=['GET'])
@require_auth
def get_user_teams():
    """Get all teams for the current user"""
    user_id = request.current_user['user_id']
    
    with SessionLocal() as session:
        results = session.query(TeamMembership, Team).join(
            Team, TeamMembership.team_id == Team.id
        ).filter(TeamMembership.user_id == user_id).all()
        
        teams = [{
            'id': str(team.id),
            'name': team.name,
            'role': membership.role.value
        } for membership, team in results]
        
        return jsonify({'teams': teams}), 200</code></pre>
                    </div>

                    <!-- MCP Team Tools Example -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h4 class="text-lg font-semibold mb-3 text-gray-800">MCP Team Tools (db_todo.py)</h4>
                        <pre class="bg-gray-100 p-4 rounded text-sm overflow-x-auto"><code>from mcp.server.fastmcp import FastMCP

mcp = FastMCP("db_todo")

# Lazy import to avoid circular dependencies
def _lazy_import_team_models():
    global User, Team, TeamMembership, TeamRole
    if User is None:
        from sambanova.models.user_models import User, Team, TeamMembership, TeamRole

@mcp.tool()
async def create_team_todo(
    title: str,
    team_id: str,
    description: Optional[str] = None,
    priority: TodoPriority = TodoPriority.MEDIUM,
    assignee_id: Optional[str] = None,
    due_date: Optional[datetime] = None,
) -> str:
    """Create a todo item for a specific team."""
    _lazy_import_team_models()
    check_database_available()
    
    with SessionLocal() as session:
        # Verify team exists
        team = session.query(Team).filter(Team.id == team_id).first()
        if not team:
            return f"Team with ID {team_id} not found."
        
        # Verify assignee is a team member
        if assignee_id:
            membership = session.query(TeamMembership).filter(
                TeamMembership.team_id == team_id,
                TeamMembership.user_id == assignee_id
            ).first()
            if not membership:
                return f"User is not a member of team '{team.name}'."
        
        # Create team todo
        new_todo = DBTodo(
            title=title,
            description=description,
            priority=priority.value,
            due_date=due_date or datetime.now(timezone.utc),
            team_id=team_id,
            assignee_id=assignee_id,
        )
        
        session.add(new_todo)
        session.commit()
        
        # Create Google Calendar event
        if get_calendar_service:
            calendar_service = get_calendar_service()
            event = calendar_service.events().insert(
                calendarId='primary',
                body={
                    'summary': f"[Team] {title}",
                    'description': f"Team: {team.name}\n{description or ''}",
                    'start': {'dateTime': due_date.isoformat(), 'timeZone': 'UTC'},
                    'end': {'dateTime': (due_date + timedelta(hours=1)).isoformat(), 'timeZone': 'UTC'}
                }
            ).execute()
            
            new_todo.google_calendar_event_id = event.get('id')
            session.commit()
        
        return f"✅ Team todo created for {team.name}"

@mcp.tool()
async def get_teams() -> str:
    """Get all available teams."""
    _lazy_import_team_models()
    
    with SessionLocal() as session:
        teams = session.query(Team).filter(Team.is_active == True).all()
        result = "Available teams:\n"
        for team in teams:
            result += f"• {team.name} (ID: {team.id})\n"
        return result

@mcp.tool()
async def get_team_members(team_id: str) -> str:
    """Get all members of a specific team."""
    _lazy_import_team_models()
    
    with SessionLocal() as session:
        team = session.query(Team).filter(Team.id == team_id).first()
        if not team:
            return f"Team not found."
        
        members = session.query(TeamMembership, User).join(
            User, TeamMembership.user_id == User.id
        ).filter(TeamMembership.team_id == team_id).all()
        
        result = f"Members of '{team.name}':\n"
        for membership, user in members:
            result += f"• {user.full_name} - {membership.role.value}\n"
        return result</code></pre>
                    </div>

                    <!-- JWT Authentication Example -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h4 class="text-lg font-semibold mb-3 text-gray-800">JWT Authentication (auth.py)</h4>
                        <pre class="bg-gray-100 p-4 rounded text-sm overflow-x-auto"><code>import jwt
import bcrypt
from datetime import datetime, timedelta, timezone
from functools import wraps
from flask import request, jsonify

class JWTAuth:
    def __init__(self):
        self.secret_key = os.getenv('JWT_SECRET_KEY')
        self.algorithm = 'HS256'
        self.access_token_expire_minutes = 30
    
    def hash_password(self, password: str) -> str:
        """Hash password using bcrypt"""
        salt = bcrypt.gensalt()
        hashed = bcrypt.hashpw(password.encode('utf-8'), salt)
        return hashed.decode('utf-8')
    
    def verify_password(self, password: str, hashed: str) -> bool:
        """Verify password against hash"""
        return bcrypt.checkpw(password.encode('utf-8'), hashed.encode('utf-8'))
    
    def create_access_token(self, user_id: str, email: str, roles: list = None) -> str:
        """Create JWT access token"""
        payload = {
            'user_id': user_id,
            'email': email,
            'roles': roles or ['user'],
            'type': 'access',
            'exp': datetime.now(timezone.utc) + timedelta(minutes=30),
            'iat': datetime.now(timezone.utc)
        }
        return jwt.encode(payload, self.secret_key, algorithm=self.algorithm)
    
    def verify_token(self, token: str) -> Optional[Dict]:
        """Verify and decode JWT token"""
        try:
            return jwt.decode(token, self.secret_key, algorithms=[self.algorithm])
        except (jwt.ExpiredSignatureError, jwt.InvalidTokenError):
            return None
    
    def require_auth(self, f):
        """Decorator to require authentication"""
        @wraps(f)
        def decorated_function(*args, **kwargs):
            token = self.get_token_from_header()
            if not token:
                return jsonify({'error': 'No token provided'}), 401
            
            payload = self.verify_token(token)
            if not payload:
                return jsonify({'error': 'Invalid or expired token'}), 401
            
            request.current_user = {
                'user_id': payload['user_id'],
                'email': payload['email'],
                'roles': payload.get('roles', [])
            }
            
            return f(*args, **kwargs)
        return decorated_function

jwt_auth = JWTAuth()
require_auth = jwt_auth.require_auth</code></pre>
                    </div>

                    <!-- Twilio Integration Example -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h4 class="text-lg font-semibold mb-3 text-gray-800">Twilio Webhook Handler (routes.py)</h4>
                        <pre class="bg-gray-100 p-4 rounded text-sm overflow-x-auto"><code>from flask import Blueprint, request, Response
from twilio.twiml.voice_response import VoiceResponse, Gather
import asyncio

sambanova_todo_bp = Blueprint('sambanova_todo', __name__, url_prefix='/sambanova_todo')

@sambanova_todo_bp.route('/twilio/call', methods=['POST'])
def twilio_call_webhook():
    """Handle incoming calls with barge-in capability"""
    is_continuation = request.args.get('is_continuation', 'false').lower() == 'true'
    response = VoiceResponse()
    
    gather = response.gather(
        input='speech',
        action='/sambanova_todo/twilio/process_audio',
        method='POST',
        speech_timeout='auto',
        timeout=10,
        barge_in=True
    )
    
    if not is_continuation:
        gather.say(
            "Hello! I'm your Sambanova productivity assistant. How can I help you today?",
            voice='Polly.Amy'
        )
    
    response.say("I didn't hear anything. Please try again.", voice='Polly.Amy')
    response.redirect('/sambanova_todo/twilio/call?is_continuation=true')
    
    return Response(str(response), mimetype='text/xml')

@sambanova_todo_bp.route('/twilio/process_audio', methods=['POST'])
def process_audio_webhook():
    """Process speech input from Twilio"""
    transcribed_text = request.form.get('SpeechResult', '')
    
    if not transcribed_text:
        response = VoiceResponse()
        gather = Gather(input='speech', action='/sambanova_todo/twilio/process_audio')
        gather.say("I didn't catch that. Could you please repeat?", voice='Polly.Amy')
        response.append(gather)
        return Response(str(response), mimetype='text/xml')
    
    # Check for exit phrases
    exit_phrases = ['exit', 'goodbye', 'bye', 'done']
    if any(phrase in transcribed_text.lower() for phrase in exit_phrases):
        response = VoiceResponse()
        response.say("Thank you! Have a great day!", voice='Polly.Amy')
        response.hangup()
        return Response(str(response), mimetype='text/xml')
    
    # Process with agent (30s timeout)
    try:
        agent_response = asyncio.run(
            asyncio.wait_for(_run_agent_async(transcribed_text), timeout=30.0)
        )
    except asyncio.TimeoutError:
        agent_response = "I'm taking too long. Please try a simpler request."
    
    # Return TwiML response
    response = VoiceResponse()
    gather = Gather(input='speech', action='/sambanova_todo/twilio/process_audio', barge_in=True)
    gather.say(agent_response, voice='Polly.Amy')
    response.append(gather)
    response.redirect('/sambanova_todo/twilio/call?is_continuation=true')
    
    return Response(str(response), mimetype='text/xml')</code></pre>
                    </div>

                </div>
            </div>
        </div>
    </section>

    <!-- Usage Guide -->
    <section class="py-16 bg-gray-50">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            <h2 class="text-3xl font-bold text-center mb-12">Usage Guide</h2>
            
            <!-- Setup and Deployment -->
            <div class="mb-12">
                <h3 class="text-2xl font-semibold mb-6 text-gray-800">Setup and Deployment</h3>
                <div class="bg-white p-6 rounded-lg shadow">
                    <div class="space-y-6">
                        <div>
                            <h4 class="text-lg font-semibold mb-3 text-gray-800">1. Environment Setup</h4>
                            <div class="bg-gray-50 p-4 rounded">
                                <pre class="text-sm"><code># Install dependencies
pip install -r requirements.txt

# Set up environment variables
export OPENAI_API_KEY="your_openai_key"
export DB_URI="postgresql://user:pass@host/db"
export JWT_SECRET_KEY="your-super-secret-jwt-key"
export TWILIO_ACCOUNT_SID="your_twilio_sid"
export TWILIO_AUTH_TOKEN="your_twilio_token"
export TWILIO_PHONE_NUMBER="+1234567890"
export GOOGLE_OAUTH2_TOKEN_B64="base64_encoded_token"
export GOOGLE_CLIENT_ID="your_client_id"
export GOOGLE_CLIENT_SECRET="your_client_secret"</code></pre>
                            </div>
                        </div>
                        
                        <div>
                            <h4 class="text-lg font-semibold mb-3 text-gray-800">2. Database Migration</h4>
                            <div class="bg-gray-50 p-4 rounded">
                                <pre class="text-sm"><code># Run team collaboration migration
python run_migration.py

# This creates:
# - users_sambanova table
# - teams_sambanova table
# - team_memberships_sambanova table
# - Adds team columns to todos_sambanova
# - Creates demo admin user (admin@sambanova.com / admin123)</code></pre>
                            </div>
                        </div>
                        
                        <div>
                            <h4 class="text-lg font-semibold mb-3 text-gray-800">3. Twilio Configuration</h4>
                            <div class="bg-gray-50 p-4 rounded">
                                <pre class="text-sm"><code># Configure Twilio phone number webhook:
Webhook URL: https://hjlees.com/sambanova_todo/twilio/call
HTTP Method: POST

# Test webhook:
curl -X POST https://hjlees.com/sambanova_todo/twilio/call \
  -d "CallSid=test123&From=+1234567890"</code></pre>
                            </div>
                        </div>
                        
                        <div>
                            <h4 class="text-lg font-semibold mb-3 text-gray-800">4. Start Production Service</h4>
                            <div class="bg-gray-50 p-4 rounded">
                                <pre class="text-sm"><code># Local development:
python app.py

# Production (Render.com):
gunicorn --worker-class gthread -w 1 --threads 4 --bind 0.0.0.0:$PORT start_simple:app

# Verify deployment:
curl https://hjlees.com/sambanova_todo/
curl https://hjlees.com/team-dashboard</code></pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Production Usage -->
            <div class="mb-12">
                <h3 class="text-2xl font-semibold mb-6 text-gray-800">Production Usage</h3>
                <div class="bg-white p-6 rounded-lg shadow">
                    <div class="mb-6">
                        <h4 class="text-lg font-semibold mb-3 text-gray-800">Team Dashboard</h4>
                        <p class="text-gray-700 mb-4">
                            Access the team dashboard at <code class="bg-gray-100 px-2 py-1 rounded">/team-dashboard</code> 
                            to manage teams, members, and todos through a web interface.
                        </p>
                        <div class="bg-blue-50 p-4 rounded border-l-4 border-blue-400">
                            <p class="text-sm text-blue-800">
                                <strong>Demo Credentials:</strong> admin@sambanova.com / admin123
                            </p>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-gray-50 p-4 rounded">
                            <h5 class="font-semibold text-gray-800 mb-2">Voice Commands (Personal)</h5>
                            <ul class="text-sm text-gray-600 space-y-1">
                                <li>• "Create a high priority todo to review the quarterly report"</li>
                                <li>• "Add a reminder to call mom tomorrow at 2 PM"</li>
                                <li>• "Schedule a meeting for Friday from 2 to 3 PM"</li>
                                <li>• "Show me all my pending todos"</li>
                                <li>• "Mark the grocery shopping todo as completed"</li>
                            </ul>
                        </div>
                        <div class="bg-gray-50 p-4 rounded">
                            <h5 class="font-semibold text-gray-800 mb-2">Voice Commands (Team)</h5>
                            <ul class="text-sm text-gray-600 space-y-1">
                                <li>• "Create a high priority todo for the development team"</li>
                                <li>• "What teams are available?"</li>
                                <li>• "Who are the members of the development team?"</li>
                                <li>• "Assign a code review task to John in the dev team"</li>
                                <li>• "Create a demo team meeting on October 10th at 5 PM"</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Technical Highlights -->
    <section class="py-12 bg-white">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            <h2 class="text-3xl font-bold text-center mb-12">Technical Highlights</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Circular Import Resolution -->
                <div class="bg-gradient-to-br from-blue-50 to-blue-100 p-6 rounded-lg shadow">
                    <h4 class="text-lg font-semibold mb-3 text-blue-800">Circular Import Resolution</h4>
                    <p class="text-sm text-gray-700 mb-3">
                        Sophisticated lazy loading pattern to break circular dependencies between MCP servers and Flask routes.
                    </p>
                    <ul class="text-xs text-gray-600 space-y-1">
                        <li>✅ Lazy import of team models</li>
                        <li>✅ Lazy agent initialization</li>
                        <li>✅ Shared Base class pattern</li>
                        <li>✅ extend_existing table args</li>
                    </ul>
                </div>
                
                <!-- Async Context Management -->
                <div class="bg-gradient-to-br from-green-50 to-green-100 p-6 rounded-lg shadow">
                    <h4 class="text-lg font-semibold mb-3 text-green-800">Async Context Management</h4>
                    <p class="text-sm text-gray-700 mb-3">
                        Proper async/await patterns with context managers for MCP client and database connections.
                    </p>
                    <ul class="text-xs text-gray-600 space-y-1">
                        <li>✅ async with MultiServerMCPClient</li>
                        <li>✅ asyncio.wait_for with timeouts</li>
                        <li>✅ ExceptionGroup handling</li>
                        <li>✅ 30s timeout for tool execution</li>
                    </ul>
                </div>
                
                <!-- Security Implementation -->
                <div class="bg-gradient-to-br from-purple-50 to-purple-100 p-6 rounded-lg shadow">
                    <h4 class="text-lg font-semibold mb-3 text-purple-800">Enterprise Security</h4>
                    <p class="text-sm text-gray-700 mb-3">
                        Production-grade security with JWT authentication, bcrypt hashing, and role-based access control.
                    </p>
                    <ul class="text-xs text-gray-600 space-y-1">
                        <li>✅ JWT HS256 tokens</li>
                        <li>✅ Bcrypt password hashing</li>
                        <li>✅ Role-based authorization</li>
                        <li>✅ Auto token expiry handling</li>
                    </ul>
                </div>
            </div>
            
            <div class="mt-8 bg-green-50 p-6 rounded-lg border-l-4 border-green-400">
                <h4 class="font-semibold text-green-800 mb-3">✅ Production-Ready Features</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <div>
                        <h5 class="font-medium text-green-700 mb-2">Infrastructure</h5>
                        <ul class="text-sm text-green-600 space-y-1">
                            <li>✅ Render.com cloud deployment</li>
                            <li>✅ PostgreSQL database</li>
                            <li>✅ Environment variable management</li>
                            <li>✅ Build scripts & migrations</li>
                        </ul>
                    </div>
                    <div>
                        <h5 class="font-medium text-green-700 mb-2">Team Collaboration</h5>
                        <ul class="text-sm text-green-600 space-y-1">
                            <li>✅ Multi-tenant architecture</li>
                            <li>✅ Team member management</li>
                            <li>✅ Task assignment</li>
                            <li>✅ Role-based permissions</li>
                        </ul>
                    </div>
                    <div>
                        <h5 class="font-medium text-green-700 mb-2">AI Integration</h5>
                        <ul class="text-sm text-green-600 space-y-1">
                            <li>✅ Voice-enabled AI agent</li>
                            <li>✅ 30+ MCP tools</li>
                            <li>✅ Google Calendar sync</li>
                            <li>✅ Natural language processing</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- API Reference -->
    <section class="py-16 bg-gray-50">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            <h2 class="text-3xl font-bold text-center mb-12">API Reference</h2>
            
            <div class="space-y-6">
                <!-- Authentication API -->
                <div class="bg-white p-6 rounded-lg shadow">
                    <h4 class="text-xl font-semibold mb-4 text-gray-800">Authentication API</h4>
                    <div class="space-y-4">
                        <div class="border-l-4 border-blue-400 pl-4">
                            <div class="font-mono text-sm font-bold text-gray-800">POST /api/auth/register</div>
                            <p class="text-sm text-gray-600 mt-1">Register a new user account</p>
                            <div class="mt-2 bg-gray-50 p-3 rounded">
                                <pre class="text-xs"><code>Request: {
  "email": "user@example.com",
  "username": "johndoe",
  "password": "secure123",
  "first_name": "John",
  "last_name": "Doe"
}

Response: {
  "message": "User registered successfully",
  "user": {...},
  "tokens": {
    "access_token": "eyJ...",
    "refresh_token": "eyJ..."
  }
}</code></pre>
                            </div>
                        </div>
                        
                        <div class="border-l-4 border-green-400 pl-4">
                            <div class="font-mono text-sm font-bold text-gray-800">POST /api/auth/login</div>
                            <p class="text-sm text-gray-600 mt-1">Login and receive JWT tokens</p>
                            <div class="mt-2 bg-gray-50 p-3 rounded">
                                <pre class="text-xs"><code>Request: {
  "email": "user@example.com",
  "password": "secure123"
}

Response: {
  "message": "Login successful",
  "user": {
    "id": "uuid",
    "email": "user@example.com",
    "teams": [...]
  },
  "tokens": {
    "access_token": "eyJ...",
    "refresh_token": "eyJ..."
  }
}</code></pre>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Team API -->
                <div class="bg-white p-6 rounded-lg shadow">
                    <h4 class="text-xl font-semibold mb-4 text-gray-800">Team Management API</h4>
                    <div class="space-y-4">
                        <div class="border-l-4 border-purple-400 pl-4">
                            <div class="font-mono text-sm font-bold text-gray-800">POST /api/teams/</div>
                            <p class="text-sm text-gray-600 mt-1">Create a new team (requires auth)</p>
                            <div class="mt-2 bg-gray-50 p-3 rounded">
                                <pre class="text-xs"><code>Headers: {
  "Authorization": "Bearer eyJ..."
}

Request: {
  "name": "Development Team",
  "description": "Core development team"
}

Response: {
  "message": "Team created successfully",
  "team": {
    "id": "uuid",
    "name": "Development Team",
    "members_count": 1
  }
}</code></pre>
                            </div>
                        </div>
                        
                        <div class="border-l-4 border-orange-400 pl-4">
                            <div class="font-mono text-sm font-bold text-gray-800">GET /api/teams/</div>
                            <p class="text-sm text-gray-600 mt-1">Get all teams for current user (requires auth)</p>
                            <div class="mt-2 bg-gray-50 p-3 rounded">
                                <pre class="text-xs"><code>Headers: {
  "Authorization": "Bearer eyJ..."
}

Response: {
  "teams": [
    {
      "id": "uuid",
      "name": "Development Team",
      "role": "owner",
      "members_count": 5
    }
  ]
}</code></pre>
                            </div>
                        </div>
                        
                        <div class="border-l-4 border-pink-400 pl-4">
                            <div class="font-mono text-sm font-bold text-gray-800">POST /api/teams/{team_id}/members</div>
                            <p class="text-sm text-gray-600 mt-1">Add member to team (requires auth)</p>
                            <div class="mt-2 bg-gray-50 p-3 rounded">
                                <pre class="text-xs"><code>Request: {
  "user_id": "uuid",
  "role": "member"
}

Response: {
  "message": "Member added successfully"
}</code></pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Performance & Deployment -->
    <section class="py-12 bg-white">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            <h2 class="text-3xl font-bold text-center mb-12">Performance & Deployment</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <div class="bg-blue-50 p-6 rounded-lg text-center">
                    <div class="text-3xl font-bold text-blue-600 mb-2">35+</div>
                    <div class="text-sm text-blue-800 font-medium">MCP Tools</div>
                    <div class="text-xs text-gray-600 mt-1">Voice-enabled operations</div>
                </div>
                <div class="bg-green-50 p-6 rounded-lg text-center">
                    <div class="text-3xl font-bold text-green-600 mb-2">30s</div>
                    <div class="text-sm text-green-800 font-medium">Agent Timeout</div>
                    <div class="text-xs text-gray-600 mt-1">Complex operations</div>
                </div>
                <div class="bg-purple-50 p-6 rounded-lg text-center">
                    <div class="text-3xl font-bold text-purple-600 mb-2">20s</div>
                    <div class="text-sm text-purple-800 font-medium">Tool Timeout</div>
                    <div class="text-xs text-gray-600 mt-1">Per MCP tool execution</div>
                </div>
                <div class="bg-orange-50 p-6 rounded-lg text-center">
                    <div class="text-3xl font-bold text-orange-600 mb-2">Multi-Tenant</div>
                    <div class="text-sm text-orange-800 font-medium">Architecture</div>
                    <div class="text-xs text-gray-600 mt-1">Teams, Users, Roles</div>
                </div>
            </div>
            
            <div class="mt-8 bg-gray-50 p-6 rounded-lg">
                <h4 class="font-semibold text-gray-800 mb-4">Deployment Stack</h4>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div class="text-center">
                        <div class="text-2xl mb-2">🚀</div>
                        <div class="text-sm font-medium text-gray-800">Render.com</div>
                        <div class="text-xs text-gray-600">Cloud Hosting</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl mb-2">🐘</div>
                        <div class="text-sm font-medium text-gray-800">PostgreSQL</div>
                        <div class="text-xs text-gray-600">Database</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl mb-2">📞</div>
                        <div class="text-sm font-medium text-gray-800">Twilio</div>
                        <div class="text-xs text-gray-600">Voice API</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl mb-2">📅</div>
                        <div class="text-sm font-medium text-gray-800">Google Calendar</div>
                        <div class="text-xs text-gray-600">OAuth2 Sync</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Back to Home -->
    <section class="py-8 bg-gray-50">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <a href="{{ url_for('home') }}" class="inline-flex items-center text-blue-600 hover:text-blue-800 font-medium">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
                </svg>
                Back to Home
            </a>
        </div>
    </section>
</div>
{% endblock %}
